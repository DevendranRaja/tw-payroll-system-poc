"use strict";
/*
 * Copyright 2018 The Diesel Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.Debouncer = void 0;
const tea_cup_core_1 = require("tea-cup-core");
class Debouncer {
    debounce(msg, delay) {
        if (this.cmd) {
            this.cmd.cancel();
            delete this.cmd;
        }
        this.cmd = new DebounceCmd(msg, delay);
        return this.cmd;
    }
}
exports.Debouncer = Debouncer;
class DebounceCmd extends tea_cup_core_1.Cmd {
    constructor(msg, delay) {
        super();
        this.msg = msg;
        this.delay = delay;
        this.canceled = false;
    }
    execute(dispatch) {
        this.timeout = setTimeout(() => {
            if (!this.canceled) {
                dispatch(this.msg);
            }
        }, this.delay);
    }
    cancel() {
        if (this.timeout) {
            clearTimeout(this.timeout);
        }
        this.canceled = true;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGVib3VuY2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0RlYm91bmNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7O0dBY0c7OztBQUVILCtDQUErQztBQUUvQyxNQUFhLFNBQVM7SUFHcEIsUUFBUSxDQUFDLEdBQU0sRUFBRSxLQUFhO1FBQzVCLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNaLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDbEIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDO1NBQ2pCO1FBQ0QsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLFdBQVcsQ0FBSSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDMUMsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ2xCLENBQUM7Q0FDRjtBQVhELDhCQVdDO0FBRUQsTUFBTSxXQUFlLFNBQVEsa0JBQU07SUFLakMsWUFDbUIsR0FBTSxFQUNOLEtBQWE7UUFFOUIsS0FBSyxFQUFFLENBQUM7UUFIUyxRQUFHLEdBQUgsR0FBRyxDQUFHO1FBQ04sVUFBSyxHQUFMLEtBQUssQ0FBUTtRQUp4QixhQUFRLEdBQUcsS0FBSyxDQUFDO0lBT3pCLENBQUM7SUFFRCxPQUFPLENBQUMsUUFBdUI7UUFDN0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNsQixRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3BCO1FBQ0gsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNqQixDQUFDO0lBRUQsTUFBTTtRQUNKLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQzVCO1FBQ0QsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7SUFDdkIsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE4IFRoZSBEaWVzZWwgQXV0aG9yc1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDbWQsIERpc3BhdGNoZXIgfSBmcm9tICd0ZWEtY3VwLWNvcmUnO1xuXG5leHBvcnQgY2xhc3MgRGVib3VuY2VyPE0+IHtcbiAgcHJpdmF0ZSBjbWQ/OiBEZWJvdW5jZUNtZDxNPjtcblxuICBkZWJvdW5jZShtc2c6IE0sIGRlbGF5OiBudW1iZXIpOiBDbWQ8TT4ge1xuICAgIGlmICh0aGlzLmNtZCkge1xuICAgICAgdGhpcy5jbWQuY2FuY2VsKCk7XG4gICAgICBkZWxldGUgdGhpcy5jbWQ7XG4gICAgfVxuICAgIHRoaXMuY21kID0gbmV3IERlYm91bmNlQ21kPE0+KG1zZywgZGVsYXkpO1xuICAgIHJldHVybiB0aGlzLmNtZDtcbiAgfVxufVxuXG5jbGFzcyBEZWJvdW5jZUNtZDxNPiBleHRlbmRzIENtZDxNPiB7XG4gIHByaXZhdGUgdGltZW91dD86IGFueTtcblxuICBwcml2YXRlIGNhbmNlbGVkID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBtc2c6IE0sXG4gICAgcHJpdmF0ZSByZWFkb25seSBkZWxheTogbnVtYmVyLFxuICApIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgZXhlY3V0ZShkaXNwYXRjaDogRGlzcGF0Y2hlcjxNPik6IHZvaWQge1xuICAgIHRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmNhbmNlbGVkKSB7XG4gICAgICAgIGRpc3BhdGNoKHRoaXMubXNnKTtcbiAgICAgIH1cbiAgICB9LCB0aGlzLmRlbGF5KTtcbiAgfVxuXG4gIGNhbmNlbCgpIHtcbiAgICBpZiAodGhpcy50aW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcbiAgICB9XG4gICAgdGhpcy5jYW5jZWxlZCA9IHRydWU7XG4gIH1cbn1cbiJdfQ==