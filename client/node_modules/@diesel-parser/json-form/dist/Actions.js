"use strict";
/*
 * Copyright 2018 The Diesel Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.setRoot = exports.actionUpdateValue = exports.actionMoveValue = exports.actionToggleExpandCollapsePath = exports.actionTriggerClicked = exports.updateMenu = exports.actionAddElementToArray = exports.actionAddProperty = exports.actionConfirmAddProperty = exports.actionAddPropertyClicked = exports.actionApplyProposal = exports.actionDeleteValue = void 0;
const Msg_1 = require("./Msg");
const tea_cup_core_1 = require("tea-cup-core");
const Model_1 = require("./Model");
const JsonValue_1 = require("./JsonValue");
const TPM = __importStar(require("tea-pop-menu"));
const ContextMenuActions_1 = require("./ContextMenuActions");
const Debouncer_1 = require("./Debouncer");
const JsFacade = __importStar(require("@diesel-parser/json-schema-facade-ts"));
function actionDeleteValue(model, path) {
    return setRoot(model, (0, JsonValue_1.deleteValueAt)(model.root.b, path).withDefault(model.root.b));
}
exports.actionDeleteValue = actionDeleteValue;
function actionApplyProposal(model, path, proposal, proposalIndex) {
    switch (proposal.tag) {
        case 'jv-object': {
            const newProposal = (0, JsonValue_1.getValueAt)(model.root.b, path)
                .map((valueAtPath) => {
                const augmentedProposal = model.validationResult
                    .andThen((vr) => {
                    // TODO deep propose only for proposalIndex
                    const all = JsFacade.propose(vr, path.format(), 5);
                    return (0, tea_cup_core_1.maybeOf)(all[proposalIndex]);
                })
                    .andThen((proposalAny) => {
                    return (0, JsonValue_1.valueFromAny)(proposalAny).match((jsonValue) => (0, tea_cup_core_1.just)(jsonValue), () => tea_cup_core_1.nothing);
                })
                    .andThen((v) => v.tag === 'jv-object' ? (0, tea_cup_core_1.just)(v) : tea_cup_core_1.nothing)
                    .withDefault(proposal);
                if (valueAtPath.tag === 'jv-object') {
                    // do not overwrite existing props
                    return (0, JsonValue_1.mergeProperties)(augmentedProposal, valueAtPath);
                }
                else {
                    return augmentedProposal;
                }
            })
                .withDefault(proposal);
            return doUpdateValue(model, path, newProposal);
        }
        default: {
            return doUpdateValue(model, path, proposal);
        }
    }
}
exports.actionApplyProposal = actionApplyProposal;
function doUpdateValue(model, path, value) {
    if (path.isEmpty()) {
        return setRoot(model, value);
    }
    return setRoot(model, (0, JsonValue_1.setValueAt)(model.root.b, path, value));
}
function actionAddPropertyClicked(model, ownerPath) {
    const focusTask = tea_cup_core_1.Task.succeedLazy(() => {
        const input = document.getElementById('property-name-editor');
        if (input) {
            input.focus();
        }
    });
    return tea_cup_core_1.Tuple.t2n(Object.assign(Object.assign({}, model), { adding: (0, tea_cup_core_1.just)({
            ownerPath,
            addingPropName: '',
            isDuplicate: false,
        }) }), tea_cup_core_1.Task.perform(focusTask, () => Msg_1.noOp));
}
exports.actionAddPropertyClicked = actionAddPropertyClicked;
function actionConfirmAddProperty(model, commit) {
    const newModel = Object.assign(Object.assign({}, model), { adding: tea_cup_core_1.nothing });
    if (!commit) {
        return (0, tea_cup_core_1.noCmd)(newModel);
    }
    return model.adding
        .filter((addingState) => addingState.addingPropName !== '')
        .andThen((addingState) => {
        return (0, JsonValue_1.mapValueAt)(model.root.b, addingState.ownerPath, (owningValue) => {
            if (owningValue.tag === 'jv-object') {
                return (0, tea_cup_core_1.just)((0, JsonValue_1.jvObject)([
                    ...owningValue.properties,
                    { name: addingState.addingPropName, value: JsonValue_1.jvNull },
                ]));
            }
            return (0, tea_cup_core_1.just)(owningValue);
        }).map((newRoot) => setRoot(newModel, newRoot));
    })
        .withDefaultSupply(() => (0, tea_cup_core_1.noCmd)(newModel));
}
exports.actionConfirmAddProperty = actionConfirmAddProperty;
function actionAddProperty(model, path, propertyName) {
    return (0, JsonValue_1.getValueAt)(model.root.b, path)
        .map((owner) => {
        if (owner.tag === 'jv-object') {
            // create the new object with a null value
            // because we need it to propose
            const newObject = (0, JsonValue_1.jvObject)([
                ...owner.properties,
                { name: propertyName, value: JsonValue_1.jvNull },
            ]);
            const newRoot = (0, JsonValue_1.setValueAt)(model.root.b, path, newObject);
            const newValidationResult = model.schema
                .map((s) => s.a)
                .map((schemaAny) => JsFacade.validate(schemaAny, (0, JsonValue_1.valueToAny)(newRoot)));
            const propertyProposals = newValidationResult
                .map((vr) => (0, Model_1.getProposals)(vr, path.append(propertyName), -1))
                .withDefault([])
                .map(JsonValue_1.clearPropertiesIfObject);
            const newObject2 = (0, JsonValue_1.jvObject)([
                ...owner.properties,
                {
                    name: propertyName,
                    value: propertyProposals.length === 0 ? JsonValue_1.jvNull : propertyProposals[0],
                },
            ]);
            return setRoot(model, (0, JsonValue_1.setValueAt)(model.root.b, path, newObject2));
        }
        return (0, tea_cup_core_1.noCmd)(model);
    })
        .withDefaultSupply(() => (0, tea_cup_core_1.noCmd)(model));
}
exports.actionAddProperty = actionAddProperty;
function actionAddElementToArray(model, path) {
    return (0, JsonValue_1.getValueAt)(model.root.b, path)
        .map((array) => {
        if (array.tag === 'jv-array') {
            const newElemIndex = array.elems.length;
            // we create a transient JsonValue with the array updated
            // so that we have a value at new index path
            // otherwise the proposals would be empty because
            // no path matches the requested index
            const tmpArray = (0, JsonValue_1.jvArray)([...array.elems, JsonValue_1.jvNull]);
            const tmpRoot = (0, JsonValue_1.setValueAt)(model.root.b, path, tmpArray);
            const newValidationResult = model.schema
                .map((s) => s.a)
                .map((schemaAny) => JsFacade.validate(schemaAny, (0, JsonValue_1.valueToAny)(tmpRoot)));
            const proposals = newValidationResult
                .map((vr) => (0, Model_1.getProposals)(vr, path.append(newElemIndex), -1))
                .withDefault([]);
            const proposal = (0, tea_cup_core_1.maybeOf)(proposals[0]).withDefault(JsonValue_1.jvNull);
            const newArray = Object.assign(Object.assign({}, array), { elems: [...array.elems, (0, JsonValue_1.clearPropertiesIfObject)(proposal)] });
            const newRoot = (0, JsonValue_1.setValueAt)(model.root.b, path, newArray);
            return setRoot(model, newRoot);
        }
        return (0, tea_cup_core_1.noCmd)(model);
    })
        .withDefaultSupply(() => (0, tea_cup_core_1.noCmd)(model));
}
exports.actionAddElementToArray = actionAddElementToArray;
function updateMenu(model, mac) {
    return tea_cup_core_1.Tuple.fromNative(mac)
        .mapFirst((mm) => {
        return Object.assign(Object.assign({}, model), { menuModel: (0, tea_cup_core_1.just)(mm) });
    })
        .mapSecond((mc) => mc.map(Msg_1.contextMenuMsg))
        .toNative();
}
exports.updateMenu = updateMenu;
function actionTriggerClicked(model, path, refBox, menuFilter) {
    return (0, JsonValue_1.getValueAt)(model.root.b, path)
        .map((valueAtPath) => {
        const focusMenuCmd = tea_cup_core_1.Task.attempt(tea_cup_core_1.Task.fromLambda(() => {
            const e = document.getElementById('dummy-textarea');
            if (e) {
                e.focus();
            }
        }), () => {
            return Msg_1.noOp;
        });
        const mac = updateMenu(model, TPM.open((0, ContextMenuActions_1.createMenu)({
            root: model.root.b,
            path,
            proposals: model.validationResult
                .map((vr) => (0, Model_1.getProposals)(vr, path, -1))
                .withDefault([]),
            valueAtPath,
            strictMode: model.strictMode,
            menuFilter,
        }), refBox));
        return tea_cup_core_1.Tuple.t2n(mac[0], tea_cup_core_1.Cmd.batch([mac[1], focusMenuCmd]));
    })
        .withDefaultSupply(() => (0, tea_cup_core_1.noCmd)(model));
}
exports.actionTriggerClicked = actionTriggerClicked;
function actionToggleExpandCollapsePath(model, path) {
    const pathStr = path.format();
    const collapsedPaths = model.collapsedPaths.has(pathStr)
        ? new Set(Array.from(model.collapsedPaths.keys()).filter((s) => s !== pathStr))
        : new Set(Array.from(model.collapsedPaths.keys()).concat(pathStr));
    return (0, tea_cup_core_1.noCmd)(Object.assign(Object.assign({}, model), { collapsedPaths }));
}
exports.actionToggleExpandCollapsePath = actionToggleExpandCollapsePath;
function actionMoveValue(model, path, direction) {
    return path
        .parent()
        .andThen((parentPath) => (0, JsonValue_1.getValueAt)(model.root.b, parentPath).andThen((parentValue) => path.lastElem().map((lastPathElem) => {
        switch (parentValue.tag) {
            case 'jv-object': {
                const newRoot = (0, JsonValue_1.moveProperty)(model.root.b, parentPath, lastPathElem, direction);
                return setRoot(model, newRoot);
            }
            case 'jv-array': {
                const index = parseInt(lastPathElem);
                if (isNaN(index)) {
                    return (0, tea_cup_core_1.noCmd)(model);
                }
                const newRoot = (0, JsonValue_1.moveElement)(model.root.b, parentPath, index, direction);
                return setRoot(model, newRoot);
            }
            default: {
                return (0, tea_cup_core_1.noCmd)(model);
            }
        }
    })))
        .withDefaultSupply(() => (0, tea_cup_core_1.noCmd)(model));
}
exports.actionMoveValue = actionMoveValue;
function actionUpdateValue(model, path, value) {
    return doUpdateValue(model, path, value);
}
exports.actionUpdateValue = actionUpdateValue;
const debouncer = new Debouncer_1.Debouncer();
function setRoot(model, root) {
    const cmd = debouncer.debounce({ tag: 'recompute-metadata' }, model.debounceMs);
    const newModel = Object.assign(Object.assign({}, model), { root: new tea_cup_core_1.Tuple((0, JsonValue_1.valueToAny)(root), root), adding: tea_cup_core_1.nothing });
    return [newModel, cmd];
}
exports.setRoot = setRoot;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWN0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9BY3Rpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7R0FjRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCwrQkFBa0Q7QUFDbEQsK0NBQStFO0FBQy9FLG1DQUE4QztBQUU5QywyQ0FrQnFCO0FBQ3JCLGtEQUFvQztBQUNwQyw2REFBOEQ7QUFFOUQsMkNBQXdDO0FBQ3hDLCtFQUFpRTtBQUdqRSxTQUFnQixpQkFBaUIsQ0FDL0IsS0FBWSxFQUNaLElBQVk7SUFFWixPQUFPLE9BQU8sQ0FDWixLQUFLLEVBQ0wsSUFBQSx5QkFBYSxFQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUM1RCxDQUFDO0FBQ0osQ0FBQztBQVJELDhDQVFDO0FBRUQsU0FBZ0IsbUJBQW1CLENBQ2pDLEtBQVksRUFDWixJQUFZLEVBQ1osUUFBbUIsRUFDbkIsYUFBcUI7SUFFckIsUUFBUSxRQUFRLENBQUMsR0FBRyxFQUFFO1FBQ3BCLEtBQUssV0FBVyxDQUFDLENBQUM7WUFDaEIsTUFBTSxXQUFXLEdBQUcsSUFBQSxzQkFBVSxFQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQztpQkFDL0MsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUU7Z0JBQ25CLE1BQU0saUJBQWlCLEdBQUcsS0FBSyxDQUFDLGdCQUFnQjtxQkFDN0MsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUU7b0JBQ2QsMkNBQTJDO29CQUMzQyxNQUFNLEdBQUcsR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQ25ELE9BQU8sSUFBQSxzQkFBTyxF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QUFDLFFBQVEsQ0FDNUIsRUFBRSxHQUFHLEVBQUUsb0JBQW9CLEVBQUUsRUFDN0IsS0FBSyxDQUFDLFVBQVUsQ0FDakIsQ0FBQztJQUNGLE1BQU0sUUFBUSxtQ0FDVCxLQUFLLEtBQ1IsSUFBSSxFQUFFLElBQUksb0JBQUssQ0FBQyxJQUFBLHNCQUFVLEVBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxDQUFDLEVBQ3ZDLE1BQU0sRUFBRSxzQkFBTyxHQUNoQixDQUFDO0lBQ0YsT0FBTyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUN6QixDQUFDO0FBWEQsMEJBV0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTggVGhlIERpZXNlbCBBdXRob3JzXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IGNvbnRleHRNZW51TXNnLCBNc2csIG5vT3AgfSBmcm9tICcuL01zZyc7XG5pbXBvcnQgeyBDbWQsIGp1c3QsIG1heWJlT2YsIG5vQ21kLCBub3RoaW5nLCBUYXNrLCBUdXBsZSB9IGZyb20gJ3RlYS1jdXAtY29yZSc7XG5pbXBvcnQgeyBnZXRQcm9wb3NhbHMsIE1vZGVsIH0gZnJvbSAnLi9Nb2RlbCc7XG5pbXBvcnQgeyBKc1BhdGggfSBmcm9tICcuL0pzUGF0aCc7XG5pbXBvcnQge1xuICBjbGVhclByb3BlcnRpZXNJZk9iamVjdCxcbiAgZGVsZXRlVmFsdWVBdCxcbiAgZ2V0VmFsdWVBdCxcbiAgSnNvblZhbHVlLFxuICBqdkFycmF5LFxuICBKdkFycmF5LFxuICBqdk51bGwsXG4gIEp2T2JqZWN0LFxuICBqdk9iamVjdCxcbiAgbWFwVmFsdWVBdCxcbiAgbWVyZ2VQcm9wZXJ0aWVzLFxuICBNb3ZlRGlyZWN0aW9uLFxuICBtb3ZlRWxlbWVudCxcbiAgbW92ZVByb3BlcnR5LFxuICBzZXRWYWx1ZUF0LFxuICB2YWx1ZUZyb21BbnksXG4gIHZhbHVlVG9BbnksXG59IGZyb20gJy4vSnNvblZhbHVlJztcbmltcG9ydCAqIGFzIFRQTSBmcm9tICd0ZWEtcG9wLW1lbnUnO1xuaW1wb3J0IHsgY3JlYXRlTWVudSwgTWVudUFjdGlvbiB9IGZyb20gJy4vQ29udGV4dE1lbnVBY3Rpb25zJztcbmltcG9ydCB7IEJveCB9IGZyb20gJ3RlYS1wb3AtY29yZSc7XG5pbXBvcnQgeyBEZWJvdW5jZXIgfSBmcm9tICcuL0RlYm91bmNlcic7XG5pbXBvcnQgKiBhcyBKc0ZhY2FkZSBmcm9tICdAZGllc2VsLXBhcnNlci9qc29uLXNjaGVtYS1mYWNhZGUtdHMnO1xuaW1wb3J0IHsgTWVudU9wdGlvbkZpbHRlciB9IGZyb20gJy4vUmVuZGVyT3B0aW9ucyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBhY3Rpb25EZWxldGVWYWx1ZShcbiAgbW9kZWw6IE1vZGVsLFxuICBwYXRoOiBKc1BhdGgsXG4pOiBbTW9kZWwsIENtZDxNc2c+XSB7XG4gIHJldHVybiBzZXRSb290KFxuICAgIG1vZGVsLFxuICAgIGRlbGV0ZVZhbHVlQXQobW9kZWwucm9vdC5iLCBwYXRoKS53aXRoRGVmYXVsdChtb2RlbC5yb290LmIpLFxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWN0aW9uQXBwbHlQcm9wb3NhbChcbiAgbW9kZWw6IE1vZGVsLFxuICBwYXRoOiBKc1BhdGgsXG4gIHByb3Bvc2FsOiBKc29uVmFsdWUsXG4gIHByb3Bvc2FsSW5kZXg6IG51bWJlcixcbik6IFtNb2RlbCwgQ21kPE1zZz5dIHtcbiAgc3dpdGNoIChwcm9wb3NhbC50YWcpIHtcbiAgICBjYXNlICdqdi1vYmplY3QnOiB7XG4gICAgICBjb25zdCBuZXdQcm9wb3NhbCA9IGdldFZhbHVlQXQobW9kZWwucm9vdC5iLCBwYXRoKVxuICAgICAgICAubWFwKCh2YWx1ZUF0UGF0aCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGF1Z21lbnRlZFByb3Bvc2FsID0gbW9kZWwudmFsaWRhdGlvblJlc3VsdFxuICAgICAgICAgICAgLmFuZFRoZW4oKHZyKSA9PiB7XG4gICAgICAgICAgICAgIC8vIFRPRE8gZGVlcCBwcm9wb3NlIG9ubHkgZm9yIHByb3Bvc2FsSW5kZXhcbiAgICAgICAgICAgICAgY29uc3QgYWxsID0gSnNGYWNhZGUucHJvcG9zZSh2ciwgcGF0aC5mb3JtYXQoKSwgNSk7XG4gICAgICAgICAgICAgIHJldHVybiBtYXliZU9mKGFsbFtwcm9wb3NhbEluZGV4XSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmFuZFRoZW4oKHByb3Bvc2FsQW55KSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiB2YWx1ZUZyb21BbnkocHJvcG9zYWxBbnkpLm1hdGNoKFxuICAgICAgICAgICAgICAgIChqc29uVmFsdWUpID0+IGp1c3QoanNvblZhbHVlKSxcbiAgICAgICAgICAgICAgICAoKSA9PiBub3RoaW5nLFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hbmRUaGVuKCh2KSA9PlxuICAgICAgICAgICAgICB2LnRhZyA9PT0gJ2p2LW9iamVjdCcgPyBqdXN0KHYgYXMgSnZPYmplY3QpIDogbm90aGluZyxcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC53aXRoRGVmYXVsdChwcm9wb3NhbCk7XG5cbiAgICAgICAgICBpZiAodmFsdWVBdFBhdGgudGFnID09PSAnanYtb2JqZWN0Jykge1xuICAgICAgICAgICAgLy8gZG8gbm90IG92ZXJ3cml0ZSBleGlzdGluZyBwcm9wc1xuICAgICAgICAgICAgcmV0dXJuIG1lcmdlUHJvcGVydGllcyhhdWdtZW50ZWRQcm9wb3NhbCwgdmFsdWVBdFBhdGgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYXVnbWVudGVkUHJvcG9zYWw7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAud2l0aERlZmF1bHQocHJvcG9zYWwpO1xuXG4gICAgICByZXR1cm4gZG9VcGRhdGVWYWx1ZShtb2RlbCwgcGF0aCwgbmV3UHJvcG9zYWwpO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICByZXR1cm4gZG9VcGRhdGVWYWx1ZShtb2RlbCwgcGF0aCwgcHJvcG9zYWwpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBkb1VwZGF0ZVZhbHVlKFxuICBtb2RlbDogTW9kZWwsXG4gIHBhdGg6IEpzUGF0aCxcbiAgdmFsdWU6IEpzb25WYWx1ZSxcbik6IFtNb2RlbCwgQ21kPE1zZz5dIHtcbiAgaWYgKHBhdGguaXNFbXB0eSgpKSB7XG4gICAgcmV0dXJuIHNldFJvb3QobW9kZWwsIHZhbHVlKTtcbiAgfVxuICByZXR1cm4gc2V0Um9vdChtb2RlbCwgc2V0VmFsdWVBdChtb2RlbC5yb290LmIsIHBhdGgsIHZhbHVlKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhY3Rpb25BZGRQcm9wZXJ0eUNsaWNrZWQoXG4gIG1vZGVsOiBNb2RlbCxcbiAgb3duZXJQYXRoOiBKc1BhdGgsXG4pOiBbTW9kZWwsIENtZDxNc2c+XSB7XG4gIGNvbnN0IGZvY3VzVGFzayA9IFRhc2suc3VjY2VlZExhenkoKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BlcnR5LW5hbWUtZWRpdG9yJyk7XG4gICAgaWYgKGlucHV0KSB7XG4gICAgICBpbnB1dC5mb2N1cygpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIFR1cGxlLnQybihcbiAgICB7XG4gICAgICAuLi5tb2RlbCxcbiAgICAgIGFkZGluZzoganVzdCh7XG4gICAgICAgIG93bmVyUGF0aCxcbiAgICAgICAgYWRkaW5nUHJvcE5hbWU6ICcnLFxuICAgICAgICBpc0R1cGxpY2F0ZTogZmFsc2UsXG4gICAgICB9KSxcbiAgICB9LFxuICAgIFRhc2sucGVyZm9ybShmb2N1c1Rhc2ssICgpID0+IG5vT3ApLFxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWN0aW9uQ29uZmlybUFkZFByb3BlcnR5KFxuICBtb2RlbDogTW9kZWwsXG4gIGNvbW1pdDogYm9vbGVhbixcbik6IFtNb2RlbCwgQ21kPE1zZz5dIHtcbiAgY29uc3QgbmV3TW9kZWw6IE1vZGVsID0ge1xuICAgIC4uLm1vZGVsLFxuICAgIGFkZGluZzogbm90aGluZyxcbiAgfTtcbiAgaWYgKCFjb21taXQpIHtcbiAgICByZXR1cm4gbm9DbWQobmV3TW9kZWwpO1xuICB9XG4gIHJldHVybiBtb2RlbC5hZGRpbmdcbiAgICAuZmlsdGVyKChhZGRpbmdTdGF0ZSkgPT4gYWRkaW5nU3RhdGUuYWRkaW5nUHJvcE5hbWUgIT09ICcnKVxuICAgIC5hbmRUaGVuKChhZGRpbmdTdGF0ZSkgPT4ge1xuICAgICAgcmV0dXJuIG1hcFZhbHVlQXQobW9kZWwucm9vdC5iLCBhZGRpbmdTdGF0ZS5vd25lclBhdGgsIChvd25pbmdWYWx1ZSkgPT4ge1xuICAgICAgICBpZiAob3duaW5nVmFsdWUudGFnID09PSAnanYtb2JqZWN0Jykge1xuICAgICAgICAgIHJldHVybiBqdXN0KFxuICAgICAgICAgICAganZPYmplY3QoW1xuICAgICAgICAgICAgICAuLi5vd25pbmdWYWx1ZS5wcm9wZXJ0aWVzLFxuICAgICAgICAgICAgICB7IG5hbWU6IGFkZGluZ1N0YXRlLmFkZGluZ1Byb3BOYW1lLCB2YWx1ZToganZOdWxsIH0sXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBqdXN0KG93bmluZ1ZhbHVlKTtcbiAgICAgIH0pLm1hcCgobmV3Um9vdCkgPT4gc2V0Um9vdChuZXdNb2RlbCwgbmV3Um9vdCkpO1xuICAgIH0pXG4gICAgLndpdGhEZWZhdWx0U3VwcGx5KCgpID0+IG5vQ21kKG5ld01vZGVsKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhY3Rpb25BZGRQcm9wZXJ0eShcbiAgbW9kZWw6IE1vZGVsLFxuICBwYXRoOiBKc1BhdGgsXG4gIHByb3BlcnR5TmFtZTogc3RyaW5nLFxuKTogW01vZGVsLCBDbWQ8TXNnPl0ge1xuICByZXR1cm4gZ2V0VmFsdWVBdChtb2RlbC5yb290LmIsIHBhdGgpXG4gICAgLm1hcDxbTW9kZWwsIENtZDxNc2c+XT4oKG93bmVyKSA9PiB7XG4gICAgICBpZiAob3duZXIudGFnID09PSAnanYtb2JqZWN0Jykge1xuICAgICAgICAvLyBjcmVhdGUgdGhlIG5ldyBvYmplY3Qgd2l0aCBhIG51bGwgdmFsdWVcbiAgICAgICAgLy8gYmVjYXVzZSB3ZSBuZWVkIGl0IHRvIHByb3Bvc2VcbiAgICAgICAgY29uc3QgbmV3T2JqZWN0ID0ganZPYmplY3QoW1xuICAgICAgICAgIC4uLm93bmVyLnByb3BlcnRpZXMsXG4gICAgICAgICAgeyBuYW1lOiBwcm9wZXJ0eU5hbWUsIHZhbHVlOiBqdk51bGwgfSxcbiAgICAgICAgXSk7XG4gICAgICAgIGNvbnN0IG5ld1Jvb3QgPSBzZXRWYWx1ZUF0KG1vZGVsLnJvb3QuYiwgcGF0aCwgbmV3T2JqZWN0KTtcbiAgICAgICAgY29uc3QgbmV3VmFsaWRhdGlvblJlc3VsdCA9IG1vZGVsLnNjaGVtYVxuICAgICAgICAgIC5tYXAoKHMpID0+IHMuYSlcbiAgICAgICAgICAubWFwKChzY2hlbWFBbnkpID0+XG4gICAgICAgICAgICBKc0ZhY2FkZS52YWxpZGF0ZShzY2hlbWFBbnksIHZhbHVlVG9BbnkobmV3Um9vdCkpLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcHJvcGVydHlQcm9wb3NhbHMgPSBuZXdWYWxpZGF0aW9uUmVzdWx0XG4gICAgICAgICAgLm1hcCgodnIpID0+IGdldFByb3Bvc2Fscyh2ciwgcGF0aC5hcHBlbmQocHJvcGVydHlOYW1lKSwgLTEpKVxuICAgICAgICAgIC53aXRoRGVmYXVsdChbXSlcbiAgICAgICAgICAubWFwKGNsZWFyUHJvcGVydGllc0lmT2JqZWN0KTtcblxuICAgICAgICBjb25zdCBuZXdPYmplY3QyID0ganZPYmplY3QoW1xuICAgICAgICAgIC4uLm93bmVyLnByb3BlcnRpZXMsXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxuICAgICAgICAgICAgdmFsdWU6XG4gICAgICAgICAgICAgIHByb3BlcnR5UHJvcG9zYWxzLmxlbmd0aCA9PT0gMCA/IGp2TnVsbCA6IHByb3BlcnR5UHJvcG9zYWxzWzBdLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0pO1xuICAgICAgICByZXR1cm4gc2V0Um9vdChtb2RlbCwgc2V0VmFsdWVBdChtb2RlbC5yb290LmIsIHBhdGgsIG5ld09iamVjdDIpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBub0NtZChtb2RlbCk7XG4gICAgfSlcbiAgICAud2l0aERlZmF1bHRTdXBwbHkoKCkgPT4gbm9DbWQobW9kZWwpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFjdGlvbkFkZEVsZW1lbnRUb0FycmF5KFxuICBtb2RlbDogTW9kZWwsXG4gIHBhdGg6IEpzUGF0aCxcbik6IFtNb2RlbCwgQ21kPE1zZz5dIHtcbiAgcmV0dXJuIGdldFZhbHVlQXQobW9kZWwucm9vdC5iLCBwYXRoKVxuICAgIC5tYXA8W01vZGVsLCBDbWQ8TXNnPl0+KChhcnJheSkgPT4ge1xuICAgICAgaWYgKGFycmF5LnRhZyA9PT0gJ2p2LWFycmF5Jykge1xuICAgICAgICBjb25zdCBuZXdFbGVtSW5kZXggPSBhcnJheS5lbGVtcy5sZW5ndGg7XG5cbiAgICAgICAgLy8gd2UgY3JlYXRlIGEgdHJhbnNpZW50IEpzb25WYWx1ZSB3aXRoIHRoZSBhcnJheSB1cGRhdGVkXG4gICAgICAgIC8vIHNvIHRoYXQgd2UgaGF2ZSBhIHZhbHVlIGF0IG5ldyBpbmRleCBwYXRoXG4gICAgICAgIC8vIG90aGVyd2lzZSB0aGUgcHJvcG9zYWxzIHdvdWxkIGJlIGVtcHR5IGJlY2F1c2VcbiAgICAgICAgLy8gbm8gcGF0aCBtYXRjaGVzIHRoZSByZXF1ZXN0ZWQgaW5kZXhcbiAgICAgICAgY29uc3QgdG1wQXJyYXkgPSBqdkFycmF5KFsuLi5hcnJheS5lbGVtcywganZOdWxsXSk7XG4gICAgICAgIGNvbnN0IHRtcFJvb3QgPSBzZXRWYWx1ZUF0KG1vZGVsLnJvb3QuYiwgcGF0aCwgdG1wQXJyYXkpO1xuXG4gICAgICAgIGNvbnN0IG5ld1ZhbGlkYXRpb25SZXN1bHQgPSBtb2RlbC5zY2hlbWFcbiAgICAgICAgICAubWFwKChzKSA9PiBzLmEpXG4gICAgICAgICAgLm1hcCgoc2NoZW1hQW55KSA9PlxuICAgICAgICAgICAgSnNGYWNhZGUudmFsaWRhdGUoc2NoZW1hQW55LCB2YWx1ZVRvQW55KHRtcFJvb3QpKSxcbiAgICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHByb3Bvc2FscyA9IG5ld1ZhbGlkYXRpb25SZXN1bHRcbiAgICAgICAgICAubWFwKCh2cikgPT4gZ2V0UHJvcG9zYWxzKHZyLCBwYXRoLmFwcGVuZChuZXdFbGVtSW5kZXgpLCAtMSkpXG4gICAgICAgICAgLndpdGhEZWZhdWx0KFtdKTtcblxuICAgICAgICBjb25zdCBwcm9wb3NhbCA9IG1heWJlT2YocHJvcG9zYWxzWzBdKS53aXRoRGVmYXVsdChqdk51bGwpO1xuICAgICAgICBjb25zdCBuZXdBcnJheTogSnZBcnJheSA9IHtcbiAgICAgICAgICAuLi5hcnJheSxcbiAgICAgICAgICBlbGVtczogWy4uLmFycmF5LmVsZW1zLCBjbGVhclByb3BlcnRpZXNJZk9iamVjdChwcm9wb3NhbCldLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBuZXdSb290ID0gc2V0VmFsdWVBdChtb2RlbC5yb290LmIsIHBhdGgsIG5ld0FycmF5KTtcbiAgICAgICAgcmV0dXJuIHNldFJvb3QobW9kZWwsIG5ld1Jvb3QpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5vQ21kKG1vZGVsKTtcbiAgICB9KVxuICAgIC53aXRoRGVmYXVsdFN1cHBseSgoKSA9PiBub0NtZChtb2RlbCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlTWVudShcbiAgbW9kZWw6IE1vZGVsLFxuICBtYWM6IFtUUE0uTW9kZWw8TWVudUFjdGlvbj4sIENtZDxUUE0uTXNnPE1lbnVBY3Rpb24+Pl0sXG4pOiBbTW9kZWwsIENtZDxNc2c+XSB7XG4gIHJldHVybiBUdXBsZS5mcm9tTmF0aXZlKG1hYylcbiAgICAubWFwRmlyc3QoKG1tKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2RlbCxcbiAgICAgICAgbWVudU1vZGVsOiBqdXN0KG1tKSxcbiAgICAgIH07XG4gICAgfSlcbiAgICAubWFwU2Vjb25kKChtYykgPT4gbWMubWFwKGNvbnRleHRNZW51TXNnKSlcbiAgICAudG9OYXRpdmUoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFjdGlvblRyaWdnZXJDbGlja2VkKFxuICBtb2RlbDogTW9kZWwsXG4gIHBhdGg6IEpzUGF0aCxcbiAgcmVmQm94OiBCb3gsXG4gIG1lbnVGaWx0ZXI/OiBNZW51T3B0aW9uRmlsdGVyLFxuKTogW01vZGVsLCBDbWQ8TXNnPl0ge1xuICByZXR1cm4gZ2V0VmFsdWVBdChtb2RlbC5yb290LmIsIHBhdGgpXG4gICAgLm1hcCgodmFsdWVBdFBhdGgpID0+IHtcbiAgICAgIGNvbnN0IGZvY3VzTWVudUNtZDogQ21kPE1zZz4gPSBUYXNrLmF0dGVtcHQoXG4gICAgICAgIFRhc2suZnJvbUxhbWJkYSgoKSA9PiB7XG4gICAgICAgICAgY29uc3QgZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkdW1teS10ZXh0YXJlYScpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICBlLmZvY3VzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHJldHVybiBub09wO1xuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgbWFjOiBbTW9kZWwsIENtZDxNc2c+XSA9IHVwZGF0ZU1lbnUoXG4gICAgICAgIG1vZGVsLFxuICAgICAgICBUUE0ub3BlbihcbiAgICAgICAgICBjcmVhdGVNZW51KHtcbiAgICAgICAgICAgIHJvb3Q6IG1vZGVsLnJvb3QuYixcbiAgICAgICAgICAgIHBhdGgsXG4gICAgICAgICAgICBwcm9wb3NhbHM6IG1vZGVsLnZhbGlkYXRpb25SZXN1bHRcbiAgICAgICAgICAgICAgLm1hcCgodnIpID0+IGdldFByb3Bvc2Fscyh2ciwgcGF0aCwgLTEpKVxuICAgICAgICAgICAgICAud2l0aERlZmF1bHQoW10pLFxuICAgICAgICAgICAgdmFsdWVBdFBhdGgsXG4gICAgICAgICAgICBzdHJpY3RNb2RlOiBtb2RlbC5zdHJpY3RNb2RlLFxuICAgICAgICAgICAgbWVudUZpbHRlcixcbiAgICAgICAgICB9KSxcbiAgICAgICAgICByZWZCb3gsXG4gICAgICAgICksXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gVHVwbGUudDJuKG1hY1swXSwgQ21kLmJhdGNoKFttYWNbMV0sIGZvY3VzTWVudUNtZF0pKTtcbiAgICB9KVxuICAgIC53aXRoRGVmYXVsdFN1cHBseSgoKSA9PiBub0NtZChtb2RlbCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWN0aW9uVG9nZ2xlRXhwYW5kQ29sbGFwc2VQYXRoKFxuICBtb2RlbDogTW9kZWwsXG4gIHBhdGg6IEpzUGF0aCxcbik6IFtNb2RlbCwgQ21kPE1zZz5dIHtcbiAgY29uc3QgcGF0aFN0ciA9IHBhdGguZm9ybWF0KCk7XG4gIGNvbnN0IGNvbGxhcHNlZFBhdGhzID0gbW9kZWwuY29sbGFwc2VkUGF0aHMuaGFzKHBhdGhTdHIpXG4gICAgPyBuZXcgU2V0KFxuICAgICAgICBBcnJheS5mcm9tKG1vZGVsLmNvbGxhcHNlZFBhdGhzLmtleXMoKSkuZmlsdGVyKChzKSA9PiBzICE9PSBwYXRoU3RyKSxcbiAgICAgIClcbiAgICA6IG5ldyBTZXQoQXJyYXkuZnJvbShtb2RlbC5jb2xsYXBzZWRQYXRocy5rZXlzKCkpLmNvbmNhdChwYXRoU3RyKSk7XG4gIHJldHVybiBub0NtZCh7XG4gICAgLi4ubW9kZWwsXG4gICAgY29sbGFwc2VkUGF0aHMsXG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWN0aW9uTW92ZVZhbHVlKFxuICBtb2RlbDogTW9kZWwsXG4gIHBhdGg6IEpzUGF0aCxcbiAgZGlyZWN0aW9uOiBNb3ZlRGlyZWN0aW9uLFxuKTogW01vZGVsLCBDbWQ8TXNnPl0ge1xuICByZXR1cm4gcGF0aFxuICAgIC5wYXJlbnQoKVxuICAgIC5hbmRUaGVuPFtNb2RlbCwgQ21kPE1zZz5dPigocGFyZW50UGF0aCkgPT5cbiAgICAgIGdldFZhbHVlQXQobW9kZWwucm9vdC5iLCBwYXJlbnRQYXRoKS5hbmRUaGVuKChwYXJlbnRWYWx1ZSkgPT5cbiAgICAgICAgcGF0aC5sYXN0RWxlbSgpLm1hcCgobGFzdFBhdGhFbGVtKSA9PiB7XG4gICAgICAgICAgc3dpdGNoIChwYXJlbnRWYWx1ZS50YWcpIHtcbiAgICAgICAgICAgIGNhc2UgJ2p2LW9iamVjdCc6IHtcbiAgICAgICAgICAgICAgY29uc3QgbmV3Um9vdCA9IG1vdmVQcm9wZXJ0eShcbiAgICAgICAgICAgICAgICBtb2RlbC5yb290LmIsXG4gICAgICAgICAgICAgICAgcGFyZW50UGF0aCxcbiAgICAgICAgICAgICAgICBsYXN0UGF0aEVsZW0sXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uLFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICByZXR1cm4gc2V0Um9vdChtb2RlbCwgbmV3Um9vdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdqdi1hcnJheSc6IHtcbiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZUludChsYXN0UGF0aEVsZW0pO1xuICAgICAgICAgICAgICBpZiAoaXNOYU4oaW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vQ21kKG1vZGVsKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zdCBuZXdSb290ID0gbW92ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgbW9kZWwucm9vdC5iLFxuICAgICAgICAgICAgICAgIHBhcmVudFBhdGgsXG4gICAgICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uLFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICByZXR1cm4gc2V0Um9vdChtb2RlbCwgbmV3Um9vdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgIHJldHVybiBub0NtZChtb2RlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICksXG4gICAgKVxuICAgIC53aXRoRGVmYXVsdFN1cHBseSgoKSA9PiBub0NtZChtb2RlbCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWN0aW9uVXBkYXRlVmFsdWUoXG4gIG1vZGVsOiBNb2RlbCxcbiAgcGF0aDogSnNQYXRoLFxuICB2YWx1ZTogSnNvblZhbHVlLFxuKTogW01vZGVsLCBDbWQ8TXNnPl0ge1xuICByZXR1cm4gZG9VcGRhdGVWYWx1ZShtb2RlbCwgcGF0aCwgdmFsdWUpO1xufVxuXG5jb25zdCBkZWJvdW5jZXIgPSBuZXcgRGVib3VuY2VyPE1zZz4oKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHNldFJvb3QobW9kZWw6IE1vZGVsLCByb290OiBKc29uVmFsdWUpOiBbTW9kZWwsIENtZDxNc2c+XSB7XG4gIGNvbnN0IGNtZCA9IGRlYm91bmNlci5kZWJvdW5jZShcbiAgICB7IHRhZzogJ3JlY29tcHV0ZS1tZXRhZGF0YScgfSxcbiAgICBtb2RlbC5kZWJvdW5jZU1zLFxuICApO1xuICBjb25zdCBuZXdNb2RlbDogTW9kZWwgPSB7XG4gICAgLi4ubW9kZWwsXG4gICAgcm9vdDogbmV3IFR1cGxlKHZhbHVlVG9Bbnkocm9vdCksIHJvb3QpLFxuICAgIGFkZGluZzogbm90aGluZyxcbiAgfTtcbiAgcmV0dXJuIFtuZXdNb2RlbCwgY21kXTtcbn1cbiJdfQ==