"use strict";
/*
 * Copyright 2018 The Diesel Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("./index");
function withErrors(schema, value, f) {
    const res = index_1.validate(schema, value);
    const errors = index_1.getErrors(res);
    expect(schema).toBe(res.schema);
    expect(value).toBe(res.value);
    f(errors);
}
describe('validate', () => {
    test('string ok', () => {
        withErrors({
            type: 'string',
        }, 'toto', (errors) => expect(errors.length).toBe(0));
    });
    test('string ko', () => {
        withErrors({
            type: 'string',
        }, 123, (errors) => {
            expect(errors.length).toBe(1);
            expect(errors[0].path).toBe('');
            expect(errors[0].message).toBe('Invalid type: expected string');
        });
    });
});
describe('renderers', function () {
    test("get renderers 1", () => {
        const schema = {
            type: "string",
            renderer: "Yalla"
        };
        const res = index_1.validate(schema, "Yo");
        const renderers = index_1.getRenderers(res);
        expect(renderers.size).toBe(1);
        const r = renderers.get("");
        expect(r).toBeDefined();
        expect(r === null || r === void 0 ? void 0 : r.key).toBe("Yalla");
        expect(r === null || r === void 0 ? void 0 : r.schemaValue).toEqual(schema);
        expect(renderers.get("yolo")).toBeUndefined();
    });
    test("get renderers 2", () => {
        const renderer = {
            key: "Yalla",
            foo: 123
        };
        const schema = {
            type: "string",
            renderer,
        };
        const res = index_1.validate(schema, "Yo");
        const renderers = index_1.getRenderers(res);
        expect(renderers.size).toBe(1);
        const r = renderers.get("");
        expect(r).toBeDefined();
        expect(r === null || r === void 0 ? void 0 : r.key).toBe("Yalla");
        expect(r === null || r === void 0 ? void 0 : r.schemaValue).toEqual(schema);
        expect(renderers.get("yolo")).toBeUndefined();
    });
});
function withProposals(schema, value, path, maxDepth, f) {
    const res = index_1.validate(schema, value);
    expect(schema).toBe(res.schema);
    expect(value).toBe(res.value);
    const proposals = index_1.propose(res, path, maxDepth);
    f(proposals);
}
describe('propose', () => {
    test('string', () => {
        withProposals({
            type: 'string',
        }, 'foo', '', -1, (proposals) => {
            expect(proposals.length).toBe(1);
            expect(proposals[0]).toBe('');
        });
    });
    const objectSchemaFooBar = {
        properties: {
            foo: {
                type: 'string',
            },
            bar: {
                type: 'number',
            },
        },
    };
    test('object depth 1', () => {
        withProposals(objectSchemaFooBar, {}, '', -1, (proposals) => {
            expect(proposals.length).toBe(1);
            expect(proposals[0]).toEqual({ foo: null, bar: null });
        });
    });
    test('object depth 2', () => {
        withProposals(objectSchemaFooBar, {}, '', 2, (proposals) => {
            expect(proposals.length).toBe(1);
            expect(proposals[0]).toEqual({ foo: '', bar: 0 });
        });
    });
});
describe('parse', () => {
    test("parser should be defined", () => {
        const p = index_1.getJsonParser({});
        expect(p).toBeDefined();
    });
    test("parser should parse", () => {
        const parseRequest = { text: "{}" };
        const res = index_1.getJsonParser({}).parse(parseRequest);
        expect(res.error).toBeUndefined();
        expect(res.success).toBe(true);
        expect(res.markers.length).toEqual(0);
        expect(res.styles.length).toEqual(0);
    });
    test("parser should validate", () => {
        const parseRequest = { text: "true" };
        const res = index_1.getJsonParser({
            type: "string"
        }).parse(parseRequest);
        expect(res.error).toBeUndefined();
        expect(res.success).toBe(true);
        expect(res.markers.length).toEqual(1);
        const m0 = res.markers[0];
        expect(m0.offset).toBe(0);
        expect(m0.length).toBe(4);
        expect(m0.severity).toBe("error");
        expect(m0.getMessage("en")).toBe("Invalid type: expected string");
    });
    test("parser should predict", () => {
        const predictRequest = { text: "", offset: 0 };
        const res = index_1.getJsonParser({}).predict(predictRequest);
        expect(res.error).toBeUndefined();
        expect(res.success).toBe(true);
        expect(res.proposals.length).toEqual(7);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7R0FjRzs7QUFFSCxtQ0FBcUc7QUFFckcsU0FBUyxVQUFVLENBQ2pCLE1BQVcsRUFDWCxLQUFVLEVBQ1YsQ0FBcUQ7SUFFckQsTUFBTSxHQUFHLEdBQUcsZ0JBQVEsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDcEMsTUFBTSxNQUFNLEdBQUcsaUJBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM5QixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNoQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM5QixDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDWixDQUFDO0FBRUQsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7SUFDeEIsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7UUFDckIsVUFBVSxDQUNSO1lBQ0UsSUFBSSxFQUFFLFFBQVE7U0FDZixFQUNELE1BQU0sRUFDTixDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQzFDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUNILElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFO1FBQ3JCLFVBQVUsQ0FDUjtZQUNFLElBQUksRUFBRSxRQUFRO1NBQ2YsRUFDRCxHQUFHLEVBQ0gsQ0FBQyxNQUFNLEVBQUUsRUFBRTtZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FB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LENBQUE7SUFDbkUsQ0FBQyxDQUFDLENBQUM7SUFDSCxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO1FBQ2pDLE1BQU0sY0FBYyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDL0MsTUFBTSxHQUFHLEdBQUcscUJBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDdEQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNsQyxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQixNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDMUMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOCBUaGUgRGllc2VsIEF1dGhvcnNcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHt2YWxpZGF0ZSwgZ2V0RXJyb3JzLCBKc1ZhbGlkYXRpb25FcnJvciwgcHJvcG9zZSwgZ2V0SnNvblBhcnNlciwgZ2V0UmVuZGVyZXJzfSBmcm9tICcuL2luZGV4JztcblxuZnVuY3Rpb24gd2l0aEVycm9ycyhcbiAgc2NoZW1hOiBhbnksXG4gIHZhbHVlOiBhbnksXG4gIGY6IChlcnJvcnM6IFJlYWRvbmx5QXJyYXk8SnNWYWxpZGF0aW9uRXJyb3I+KSA9PiB2b2lkLFxuKSB7XG4gIGNvbnN0IHJlcyA9IHZhbGlkYXRlKHNjaGVtYSwgdmFsdWUpO1xuICBjb25zdCBlcnJvcnMgPSBnZXRFcnJvcnMocmVzKTtcbiAgZXhwZWN0KHNjaGVtYSkudG9CZShyZXMuc2NoZW1hKTtcbiAgZXhwZWN0KHZhbHVlKS50b0JlKHJlcy52YWx1ZSk7XG4gIGYoZXJyb3JzKTtcbn1cblxuZGVzY3JpYmUoJ3ZhbGlkYXRlJywgKCkgPT4ge1xuICB0ZXN0KCdzdHJpbmcgb2snLCAoKSA9PiB7XG4gICAgd2l0aEVycm9ycyhcbiAgICAgIHtcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICB9LFxuICAgICAgJ3RvdG8nLFxuICAgICAgKGVycm9ycykgPT4gZXhwZWN0KGVycm9ycy5sZW5ndGgpLnRvQmUoMCksXG4gICAgKTtcbiAgfSk7XG4gIHRlc3QoJ3N0cmluZyBrbycsICgpID0+IHtcbiAgICB3aXRoRXJyb3JzKFxuICAgICAge1xuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgIH0sXG4gICAgICAxMjMsXG4gICAgICAoZXJyb3JzKSA9PiB7XG4gICAgICAgIGV4cGVjdChlcnJvcnMubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgICBleHBlY3QoZXJyb3JzWzBdLnBhdGgpLnRvQmUoJycpO1xuICAgICAgICBleHBlY3QoZXJyb3JzWzBdLm1lc3NhZ2UpLnRvQmUoJ0ludmFsaWQgdHlwZTogZXhwZWN0ZWQgc3RyaW5nJyk7XG4gICAgICB9LFxuICAgICk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdyZW5kZXJlcnMnLCBmdW5jdGlvbiAoKSB7XG4gIHRlc3QoXCJnZXQgcmVuZGVyZXJzIDFcIiwgKCkgPT4ge1xuICAgIGNvbnN0IHNjaGVtYSA9IHtcbiAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICByZW5kZXJlcjogXCJZYWxsYVwiXG4gICAgfTtcbiAgICBjb25zdCByZXMgPSB2YWxpZGF0ZShzY2hlbWEsIFwiWW9cIik7XG4gICAgY29uc3QgcmVuZGVyZXJzID0gZ2V0UmVuZGVyZXJzKHJlcyk7XG4gICAgZXhwZWN0KHJlbmRlcmVycy5zaXplKS50b0JlKDEpO1xuICAgIGNvbnN0IHIgPSByZW5kZXJlcnMuZ2V0KFwiXCIpO1xuICAgIGV4cGVjdChyKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChyPy5rZXkpLnRvQmUoXCJZYWxsYVwiKTtcbiAgICBleHBlY3Qocj8uc2NoZW1hVmFsdWUpLnRvRXF1YWwoc2NoZW1hKTtcbiAgICBleHBlY3QocmVuZGVyZXJzLmdldChcInlvbG9cIikpLnRvQmVVbmRlZmluZWQoKTtcbiAgfSk7XG5cbiAgdGVzdChcImdldCByZW5kZXJlcnMgMlwiLCAoKSA9PiB7XG4gICAgY29uc3QgcmVuZGVyZXIgPSB7XG4gICAgICBrZXk6IFwiWWFsbGFcIixcbiAgICAgIGZvbzogMTIzXG4gICAgfTtcblxuICAgIGNvbnN0IHNjaGVtYSA9IHtcbiAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICByZW5kZXJlcixcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzID0gdmFsaWRhdGUoc2NoZW1hLCBcIllvXCIpO1xuICAgIGNvbnN0IHJlbmRlcmVycyA9IGdldFJlbmRlcmVycyhyZXMpO1xuICAgIGV4cGVjdChyZW5kZXJlcnMuc2l6ZSkudG9CZSgxKTtcbiAgICBjb25zdCByID0gcmVuZGVyZXJzLmdldChcIlwiKTtcbiAgICBleHBlY3QocikudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3Qocj8ua2V5KS50b0JlKFwiWWFsbGFcIik7XG4gICAgZXhwZWN0KHI/LnNjaGVtYVZhbHVlKS50b0VxdWFsKHNjaGVtYSk7XG4gICAgZXhwZWN0KHJlbmRlcmVycy5nZXQoXCJ5b2xvXCIpKS50b0JlVW5kZWZpbmVkKCk7XG4gIH0pXG5cbn0pO1xuXG5mdW5jdGlvbiB3aXRoUHJvcG9zYWxzKFxuICBzY2hlbWE6IGFueSxcbiAgdmFsdWU6IGFueSxcbiAgcGF0aDogc3RyaW5nLFxuICBtYXhEZXB0aDogbnVtYmVyLFxuICBmOiAocHJvcG9zYWxzOiBSZWFkb25seUFycmF5PGFueT4pID0+IHZvaWQsXG4pIHtcbiAgY29uc3QgcmVzID0gdmFsaWRhdGUoc2NoZW1hLCB2YWx1ZSk7XG4gIGV4cGVjdChzY2hlbWEpLnRvQmUocmVzLnNjaGVtYSk7XG4gIGV4cGVjdCh2YWx1ZSkudG9CZShyZXMudmFsdWUpO1xuICBjb25zdCBwcm9wb3NhbHMgPSBwcm9wb3NlKHJlcywgcGF0aCwgbWF4RGVwdGgpO1xuICBmKHByb3Bvc2Fscyk7XG59XG5cbmRlc2NyaWJlKCdwcm9wb3NlJywgKCkgPT4ge1xuICB0ZXN0KCdzdHJpbmcnLCAoKSA9PiB7XG4gICAgd2l0aFByb3Bvc2FscyhcbiAgICAgIHtcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICB9LFxuICAgICAgJ2ZvbycsXG4gICAgICAnJyxcbiAgICAgIC0xLFxuICAgICAgKHByb3Bvc2FscykgPT4ge1xuICAgICAgICBleHBlY3QocHJvcG9zYWxzLmxlbmd0aCkudG9CZSgxKTtcbiAgICAgICAgZXhwZWN0KHByb3Bvc2Fsc1swXSkudG9CZSgnJyk7XG4gICAgICB9LFxuICAgICk7XG4gIH0pO1xuXG4gIGNvbnN0IG9iamVjdFNjaGVtYUZvb0JhciA9IHtcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICBmb286IHtcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICB9LFxuICAgICAgYmFyOiB7XG4gICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIHRlc3QoJ29iamVjdCBkZXB0aCAxJywgKCkgPT4ge1xuICAgIHdpdGhQcm9wb3NhbHMob2JqZWN0U2NoZW1hRm9vQmFyLCB7fSwgJycsIC0xLCAocHJvcG9zYWxzKSA9PiB7XG4gICAgICBleHBlY3QocHJvcG9zYWxzLmxlbmd0aCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChwcm9wb3NhbHNbMF0pLnRvRXF1YWwoeyBmb286IG51bGwsIGJhcjogbnVsbCB9KTtcbiAgICB9KTtcbiAgfSk7XG4gIHRlc3QoJ29iamVjdCBkZXB0aCAyJywgKCkgPT4ge1xuICAgIHdpdGhQcm9wb3NhbHMob2JqZWN0U2NoZW1hRm9vQmFyLCB7fSwgJycsIDIsIChwcm9wb3NhbHMpID0+IHtcbiAgICAgIGV4cGVjdChwcm9wb3NhbHMubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHByb3Bvc2Fsc1swXSkudG9FcXVhbCh7IGZvbzogJycsIGJhcjogMCB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3BhcnNlJywgKCkgPT4ge1xuICB0ZXN0KFwicGFyc2VyIHNob3VsZCBiZSBkZWZpbmVkXCIsICgpID0+IHtcbiAgICBjb25zdCBwID0gZ2V0SnNvblBhcnNlcih7fSk7XG4gICAgZXhwZWN0KHApLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuICB0ZXN0KFwicGFyc2VyIHNob3VsZCBwYXJzZVwiLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyc2VSZXF1ZXN0ID0geyB0ZXh0OiBcInt9XCIgfTtcbiAgICBjb25zdCByZXMgPSBnZXRKc29uUGFyc2VyKHt9KS5wYXJzZShwYXJzZVJlcXVlc3QpO1xuICAgIGV4cGVjdChyZXMuZXJyb3IpLnRvQmVVbmRlZmluZWQoKTtcbiAgICBleHBlY3QocmVzLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KHJlcy5tYXJrZXJzLmxlbmd0aCkudG9FcXVhbCgwKTtcbiAgICBleHBlY3QocmVzLnN0eWxlcy5sZW5ndGgpLnRvRXF1YWwoMCk7XG4gIH0pO1xuICB0ZXN0KFwicGFyc2VyIHNob3VsZCB2YWxpZGF0ZVwiLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyc2VSZXF1ZXN0ID0geyB0ZXh0OiBcInRydWVcIiB9O1xuICAgIGNvbnN0IHJlcyA9IGdldEpzb25QYXJzZXIoe1xuICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgIH0pLnBhcnNlKHBhcnNlUmVxdWVzdCk7XG4gICAgZXhwZWN0KHJlcy5lcnJvcikudG9CZVVuZGVmaW5lZCgpO1xuICAgIGV4cGVjdChyZXMuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICBleHBlY3QocmVzLm1hcmtlcnMubGVuZ3RoKS50b0VxdWFsKDEpO1xuICAgIGNvbnN0IG0wID0gcmVzLm1hcmtlcnNbMF07XG4gICAgZXhwZWN0KG0wLm9mZnNldCkudG9CZSgwKTtcbiAgICBleHBlY3QobTAubGVuZ3RoKS50b0JlKDQpO1xuICAgIGV4cGVjdChtMC5zZXZlcml0eSkudG9CZShcImVycm9yXCIpO1xuICAgIGV4cGVjdChtMC5nZXRNZXNzYWdlKFwiZW5cIikpLnRvQmUoXCJJbnZhbGlkIHR5cGU6IGV4cGVjdGVkIHN0cmluZ1wiKVxuICB9KTtcbiAgdGVzdChcInBhcnNlciBzaG91bGQgcHJlZGljdFwiLCAoKSA9PiB7XG4gICAgY29uc3QgcHJlZGljdFJlcXVlc3QgPSB7IHRleHQ6IFwiXCIsIG9mZnNldDogMCB9O1xuICAgIGNvbnN0IHJlcyA9IGdldEpzb25QYXJzZXIoe30pLnByZWRpY3QocHJlZGljdFJlcXVlc3QpO1xuICAgIGV4cGVjdChyZXMuZXJyb3IpLnRvQmVVbmRlZmluZWQoKTtcbiAgICBleHBlY3QocmVzLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KHJlcy5wcm9wb3NhbHMubGVuZ3RoKS50b0VxdWFsKDcpO1xuICB9KTtcbn0pO1xuIl19