/*
 * MIT License
 *
 * Copyright (c) 2019 RÃ©mi Van Keisbelck
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
import { Sub } from 'tea-cup-core';
let subCount = 0;
class DocSub extends Sub {
    constructor(documentEvents, key, mapper, options) {
        super();
        this.documentEvents = documentEvents;
        this.key = key;
        this.mapper = mapper;
        this.options = options;
        subCount++;
        this.sc = subCount;
        this.listener = (e) => this.isActive() &&
            setTimeout(() => {
                this.dispatch(this.mapper(e));
            });
    }
    onInit() {
        super.onInit();
        this.documentEvents.doAddListener(this.key, this.listener, this.options);
    }
    onRelease() {
        super.onRelease();
        this.documentEvents.doRemoveListener(this.key, this.listener, this.options);
    }
}
class EventMapEvents {
    /**
     * Subscribe to an event.
     * @param key the event type to subscribe to.
     * @param mapper map the event to a message.
     * @param options options for this listener
     */
    on(key, mapper, options) {
        return new DocSub(this, key, mapper, options);
    }
}
/**
 * Subscribe to document events.
 */
export class DocumentEvents extends EventMapEvents {
    doAddListener(key, listener, options) {
        document.addEventListener(key, listener, options);
    }
    doRemoveListener(key, listener, options) {
        document.removeEventListener(key, listener, options);
    }
}
/**
 * Bonus, WindowEvents
 */
export class WindowEvents extends EventMapEvents {
    doAddListener(key, listener, options) {
        window.addEventListener(key, listener, options);
    }
    doRemoveListener(key, listener, options) {
        window.removeEventListener(key, listener, options);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9jdW1lbnRFdmVudHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvVGVhQ3VwL0RvY3VtZW50RXZlbnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXVCRztBQUVILE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFNbkMsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBRWpCLE1BQU0sTUFBc0MsU0FBUSxHQUFRO0lBSTFELFlBQ21CLGNBQXdDLEVBQ3hDLEdBQU0sRUFDTixNQUEyQixFQUMzQixPQUF5QjtRQUUxQyxLQUFLLEVBQUUsQ0FBQztRQUxTLG1CQUFjLEdBQWQsY0FBYyxDQUEwQjtRQUN4QyxRQUFHLEdBQUgsR0FBRyxDQUFHO1FBQ04sV0FBTSxHQUFOLE1BQU0sQ0FBcUI7UUFDM0IsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFHMUMsUUFBUSxFQUFFLENBQUM7UUFDWCxJQUFJLENBQUMsRUFBRSxHQUFHLFFBQVEsQ0FBQztRQUNuQixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDcEIsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNmLFVBQVUsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRVMsTUFBTTtRQUNkLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNmLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDM0UsQ0FBQztJQUVTLFNBQVM7UUFDakIsS0FBSyxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM5RSxDQUFDO0NBQ0Y7QUFFRCxNQUFlLGNBQWM7SUFhM0I7Ozs7O09BS0c7SUFDSSxFQUFFLENBQ1AsR0FBTSxFQUNOLE1BQTBCLEVBQzFCLE9BQTJDO1FBRTNDLE9BQU8sSUFBSSxNQUFNLENBQWMsSUFBSSxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDN0QsQ0FBQztDQUNGO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLE9BQU8sY0FBb0IsU0FBUSxjQUFxQztJQUM1RSxhQUFhLENBQ1gsR0FBTSxFQUNOLFFBQTBDLEVBQzFDLE9BQTJDO1FBRTNDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCxnQkFBZ0IsQ0FDZCxHQUFNLEVBQ04sUUFBMEMsRUFDMUMsT0FBMkM7UUFFM0MsUUFBUSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDdkQsQ0FBQztDQUNGO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLE9BQU8sWUFBa0IsU0FBUSxjQUFtQztJQUN4RSxhQUFhLENBQ1gsR0FBTSxFQUNOLFFBQXdDLEVBQ3hDLE9BQTJDO1FBRTNDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFFRCxnQkFBZ0IsQ0FDZCxHQUFNLEVBQ04sUUFBd0MsRUFDeEMsT0FBMkM7UUFFM0MsTUFBTSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDckQsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1JVCBMaWNlbnNlXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDE5IFLDqW1pIFZhbiBLZWlzYmVsY2tcbiAqXG4gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4gKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4gKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4gKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4gKlxuICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG4gKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICpcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcbiAqIFNPRlRXQVJFLlxuICpcbiAqL1xuXG5pbXBvcnQgeyBTdWIgfSBmcm9tICd0ZWEtY3VwLWNvcmUnO1xuXG50eXBlIExpc3RlbmVyPEU+ID0gKGV2OiBFKSA9PiBhbnk7XG50eXBlIExpc3RlbmVyT3B0aW9ucyA9IGJvb2xlYW4gfCBBZGRFdmVudExpc3RlbmVyT3B0aW9ucztcbnR5cGUgTWFwcGVyPEUsIE1zZz4gPSAoZXY6IEUpID0+IE1zZztcblxubGV0IHN1YkNvdW50ID0gMDtcblxuY2xhc3MgRG9jU3ViPEsgZXh0ZW5kcyBrZXlvZiBNYXAsIE1hcCwgTXNnPiBleHRlbmRzIFN1YjxNc2c+IHtcbiAgcHJpdmF0ZSByZWFkb25seSBsaXN0ZW5lcjogTGlzdGVuZXI8TWFwW0tdPjtcbiAgcHJpdmF0ZSBzYzogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZG9jdW1lbnRFdmVudHM6IEV2ZW50TWFwRXZlbnRzPE1hcCwgTXNnPixcbiAgICBwcml2YXRlIHJlYWRvbmx5IGtleTogSyxcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1hcHBlcjogTWFwcGVyPE1hcFtLXSwgTXNnPixcbiAgICBwcml2YXRlIHJlYWRvbmx5IG9wdGlvbnM/OiBMaXN0ZW5lck9wdGlvbnMsXG4gICkge1xuICAgIHN1cGVyKCk7XG4gICAgc3ViQ291bnQrKztcbiAgICB0aGlzLnNjID0gc3ViQ291bnQ7XG4gICAgdGhpcy5saXN0ZW5lciA9IChlKSA9PlxuICAgICAgdGhpcy5pc0FjdGl2ZSgpICYmXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5kaXNwYXRjaCh0aGlzLm1hcHBlcihlKSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBvbkluaXQoKSB7XG4gICAgc3VwZXIub25Jbml0KCk7XG4gICAgdGhpcy5kb2N1bWVudEV2ZW50cy5kb0FkZExpc3RlbmVyKHRoaXMua2V5LCB0aGlzLmxpc3RlbmVyLCB0aGlzLm9wdGlvbnMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIG9uUmVsZWFzZSgpIHtcbiAgICBzdXBlci5vblJlbGVhc2UoKTtcbiAgICB0aGlzLmRvY3VtZW50RXZlbnRzLmRvUmVtb3ZlTGlzdGVuZXIodGhpcy5rZXksIHRoaXMubGlzdGVuZXIsIHRoaXMub3B0aW9ucyk7XG4gIH1cbn1cblxuYWJzdHJhY3QgY2xhc3MgRXZlbnRNYXBFdmVudHM8TWFwLCBNc2c+IHtcbiAgYWJzdHJhY3QgZG9BZGRMaXN0ZW5lcjxLIGV4dGVuZHMga2V5b2YgTWFwPihcbiAgICBrZXk6IEssXG4gICAgbGlzdGVuZXI6IChldjogTWFwW0tdKSA9PiBhbnksXG4gICAgb3B0aW9ucz86IGJvb2xlYW4gfCBBZGRFdmVudExpc3RlbmVyT3B0aW9ucyxcbiAgKTogdm9pZDtcblxuICBhYnN0cmFjdCBkb1JlbW92ZUxpc3RlbmVyPEsgZXh0ZW5kcyBrZXlvZiBNYXA+KFxuICAgIGtleTogSyxcbiAgICBsaXN0ZW5lcjogKGV2OiBNYXBbS10pID0+IGFueSxcbiAgICBvcHRpb25zPzogYm9vbGVhbiB8IEFkZEV2ZW50TGlzdGVuZXJPcHRpb25zLFxuICApOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBTdWJzY3JpYmUgdG8gYW4gZXZlbnQuXG4gICAqIEBwYXJhbSBrZXkgdGhlIGV2ZW50IHR5cGUgdG8gc3Vic2NyaWJlIHRvLlxuICAgKiBAcGFyYW0gbWFwcGVyIG1hcCB0aGUgZXZlbnQgdG8gYSBtZXNzYWdlLlxuICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25zIGZvciB0aGlzIGxpc3RlbmVyXG4gICAqL1xuICBwdWJsaWMgb248SyBleHRlbmRzIGtleW9mIE1hcCwgTXNnPihcbiAgICBrZXk6IEssXG4gICAgbWFwcGVyOiAoZTogTWFwW0tdKSA9PiBNc2csXG4gICAgb3B0aW9ucz86IGJvb2xlYW4gfCBBZGRFdmVudExpc3RlbmVyT3B0aW9ucyxcbiAgKTogU3ViPE1zZz4ge1xuICAgIHJldHVybiBuZXcgRG9jU3ViPEssIE1hcCwgTXNnPih0aGlzLCBrZXksIG1hcHBlciwgb3B0aW9ucyk7XG4gIH1cbn1cblxuLyoqXG4gKiBTdWJzY3JpYmUgdG8gZG9jdW1lbnQgZXZlbnRzLlxuICovXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRFdmVudHM8TXNnPiBleHRlbmRzIEV2ZW50TWFwRXZlbnRzPERvY3VtZW50RXZlbnRNYXAsIE1zZz4ge1xuICBkb0FkZExpc3RlbmVyPEsgZXh0ZW5kcyBrZXlvZiBEb2N1bWVudEV2ZW50TWFwPihcbiAgICBrZXk6IEssXG4gICAgbGlzdGVuZXI6IChldjogRG9jdW1lbnRFdmVudE1hcFtLXSkgPT4gYW55LFxuICAgIG9wdGlvbnM/OiBib29sZWFuIHwgQWRkRXZlbnRMaXN0ZW5lck9wdGlvbnMsXG4gICk6IHZvaWQge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoa2V5LCBsaXN0ZW5lciwgb3B0aW9ucyk7XG4gIH1cblxuICBkb1JlbW92ZUxpc3RlbmVyPEsgZXh0ZW5kcyBrZXlvZiBEb2N1bWVudEV2ZW50TWFwPihcbiAgICBrZXk6IEssXG4gICAgbGlzdGVuZXI6IChldjogRG9jdW1lbnRFdmVudE1hcFtLXSkgPT4gYW55LFxuICAgIG9wdGlvbnM/OiBib29sZWFuIHwgQWRkRXZlbnRMaXN0ZW5lck9wdGlvbnMsXG4gICk6IHZvaWQge1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoa2V5LCBsaXN0ZW5lciwgb3B0aW9ucyk7XG4gIH1cbn1cblxuLyoqXG4gKiBCb251cywgV2luZG93RXZlbnRzXG4gKi9cbmV4cG9ydCBjbGFzcyBXaW5kb3dFdmVudHM8TXNnPiBleHRlbmRzIEV2ZW50TWFwRXZlbnRzPFdpbmRvd0V2ZW50TWFwLCBNc2c+IHtcbiAgZG9BZGRMaXN0ZW5lcjxLIGV4dGVuZHMga2V5b2YgV2luZG93RXZlbnRNYXA+KFxuICAgIGtleTogSyxcbiAgICBsaXN0ZW5lcjogKGV2OiBXaW5kb3dFdmVudE1hcFtLXSkgPT4gYW55LFxuICAgIG9wdGlvbnM/OiBib29sZWFuIHwgQWRkRXZlbnRMaXN0ZW5lck9wdGlvbnMsXG4gICk6IHZvaWQge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGtleSwgbGlzdGVuZXIsIG9wdGlvbnMpO1xuICB9XG5cbiAgZG9SZW1vdmVMaXN0ZW5lcjxLIGV4dGVuZHMga2V5b2YgV2luZG93RXZlbnRNYXA+KFxuICAgIGtleTogSyxcbiAgICBsaXN0ZW5lcjogKGV2OiBXaW5kb3dFdmVudE1hcFtLXSkgPT4gYW55LFxuICAgIG9wdGlvbnM/OiBib29sZWFuIHwgQWRkRXZlbnRMaXN0ZW5lck9wdGlvbnMsXG4gICk6IHZvaWQge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKGtleSwgbGlzdGVuZXIsIG9wdGlvbnMpO1xuICB9XG59XG4iXX0=