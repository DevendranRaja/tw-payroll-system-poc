"use strict";
/*
 * MIT License
 *
 * Copyright (c) 2020 RÃ©mi Van Keisbelck
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.place1DStart = exports.place1DEnd = exports.placeCombo = exports.place = void 0;
const Box_1 = require("./Box");
const Dim_1 = require("./Dim");
const Pos_1 = require("./Pos");
function place(viewport, refBox, elem) {
    const pX = place1DEnd(viewport.w, refBox.p.x, refBox.d.w, elem.w);
    const pY = place1DStart(viewport.h, refBox.p.y, refBox.d.h, elem.h);
    return Box_1.box(Pos_1.pos(pX.offset, pY.offset), Dim_1.dim(pX.len, pY.len));
}
exports.place = place;
function placeCombo(viewport, refBox, elem) {
    const pX = place1DStart(viewport.w, refBox.p.x, refBox.d.w, elem.w);
    const pY = placeComboY(viewport.h, refBox.p.y, refBox.d.h, elem.h);
    return Box_1.box(Pos_1.pos(pX.offset, pY.offset), Dim_1.dim(pX.len, pY.len));
}
exports.placeCombo = placeCombo;
function place1DEnd(viewportW, refX, refW, elemW) {
    if (refX + refW + elemW > viewportW) {
        // not enough space after, try before
        if (elemW < refX) {
            // ok, prepend
            return { offset: refX - elemW, len: elemW };
        }
        else {
            // not enough space before or after, we have to translate and/or expand !
            if (elemW < viewportW) {
                // can't append or prepend, but no need to shrink... translate only
                const delta = refX + refW + elemW - viewportW;
                return { offset: refX + refW - delta, len: elemW };
            }
            return { offset: 0, len: viewportW };
        }
    }
    else {
        // enough space to append
        return { offset: refX + refW, len: elemW };
    }
}
exports.place1DEnd = place1DEnd;
function place1DStart(viewportW, refX, refW, elemW) {
    if (elemW > viewportW) {
        return { offset: 0, len: viewportW };
    }
    if (refX + elemW > viewportW) {
        // not enough space after, try before
        if (elemW < refX + refW) {
            // ok, prepend
            return { offset: refX + refW - elemW, len: elemW };
        }
        else {
            // not enough space before or after, we have to translate and/or expand !
            if (elemW < viewportW) {
                // can't append or prepend, but no need to shrink... translate only
                const delta = refX + refW + elemW - viewportW;
                return { offset: refX + refW - delta, len: elemW };
            }
            return { offset: 0, len: 10 };
        }
    }
    else {
        // enough space to append
        return { offset: refX, len: elemW };
    }
}
exports.place1DStart = place1DStart;
function placeComboY(viewportW, refX, refW, elemW) {
    const elemEnd = refX + refW;
    const spaceBefore = refX;
    const spaceAfter = viewportW - elemEnd;
    if (elemW < spaceAfter) {
        // enough space after, append
        return { offset: elemEnd, len: elemW };
    }
    else if (elemW < spaceBefore) {
        // enough space before, append
        return { offset: refX - elemW, len: elemW };
    }
    else {
        // not enough space, need to shrink
        // use the most space
        if (spaceBefore > spaceAfter) {
            // place before
            return { offset: 0, len: spaceBefore };
        }
        else {
            return { offset: elemEnd, len: spaceAfter };
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUG9wb3Zlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9Qb3BvdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Qkc7OztBQUVILCtCQUFpQztBQUNqQywrQkFBaUM7QUFDakMsK0JBQTRCO0FBRTVCLFNBQWdCLEtBQUssQ0FBQyxRQUFhLEVBQUUsTUFBVyxFQUFFLElBQVM7SUFDekQsTUFBTSxFQUFFLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xFLE1BQU0sRUFBRSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwRSxPQUFPLFNBQUcsQ0FBQyxTQUFHLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsU0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDN0QsQ0FBQztBQUpELHNCQUlDO0FBRUQsU0FBZ0IsVUFBVSxDQUFDLFFBQWEsRUFBRSxNQUFXLEVBQUUsSUFBUztJQUM5RCxNQUFNLEVBQUUsR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEUsTUFBTSxFQUFFLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENB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QUFVLEVBQUU7UUFDdEIsNkJBQTZCO1FBQzdCLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQztLQUN4QztTQUFNLElBQUksS0FBSyxHQUFHLFdBQVcsRUFBRTtRQUM5Qiw4QkFBOEI7UUFDOUIsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQztLQUM3QztTQUFNO1FBQ0wsbUNBQW1DO1FBQ25DLHFCQUFxQjtRQUNyQixJQUFJLFdBQVcsR0FBRyxVQUFVLEVBQUU7WUFDNUIsZUFBZTtZQUNmLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsQ0FBQztTQUN4QzthQUFNO1lBQ0wsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxDQUFDO1NBQzdDO0tBQ0Y7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1JVCBMaWNlbnNlXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDIwIFLDqW1pIFZhbiBLZWlzYmVsY2tcbiAqXG4gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4gKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4gKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4gKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4gKlxuICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG4gKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICpcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcbiAqIFNPRlRXQVJFLlxuICpcbiAqL1xuXG5pbXBvcnQgeyBib3gsIEJveCB9IGZyb20gJy4vQm94JztcbmltcG9ydCB7IGRpbSwgRGltIH0gZnJvbSAnLi9EaW0nO1xuaW1wb3J0IHsgcG9zIH0gZnJvbSAnLi9Qb3MnO1xuXG5leHBvcnQgZnVuY3Rpb24gcGxhY2Uodmlld3BvcnQ6IERpbSwgcmVmQm94OiBCb3gsIGVsZW06IERpbSk6IEJveCB7XG4gIGNvbnN0IHBYID0gcGxhY2UxREVuZCh2aWV3cG9ydC53LCByZWZCb3gucC54LCByZWZCb3guZC53LCBlbGVtLncpO1xuICBjb25zdCBwWSA9IHBsYWNlMURTdGFydCh2aWV3cG9ydC5oLCByZWZCb3gucC55LCByZWZCb3guZC5oLCBlbGVtLmgpO1xuICByZXR1cm4gYm94KHBvcyhwWC5vZmZzZXQsIHBZLm9mZnNldCksIGRpbShwWC5sZW4sIHBZLmxlbikpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGxhY2VDb21ibyh2aWV3cG9ydDogRGltLCByZWZCb3g6IEJveCwgZWxlbTogRGltKTogQm94IHtcbiAgY29uc3QgcFggPSBwbGFjZTFEU3RhcnQodmlld3BvcnQudywgcmVmQm94LnAueCwgcmVmQm94LmQudywgZWxlbS53KTtcbiAgY29uc3QgcFkgPSBwbGFjZUNvbWJvWSh2aWV3cG9ydC5oLCByZWZCb3gucC55LCByZWZCb3guZC5oLCBlbGVtLmgpO1xuICByZXR1cm4gYm94KHBvcyhwWC5vZmZzZXQsIHBZLm9mZnNldCksIGRpbShwWC5sZW4sIHBZLmxlbikpO1xufVxuXG5pbnRlcmZhY2UgUGxhY2VkMUQge1xuICByZWFkb25seSBvZmZzZXQ6IG51bWJlcjtcbiAgcmVhZG9ubHkgbGVuOiBudW1iZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwbGFjZTFERW5kKFxuICB2aWV3cG9ydFc6IG51bWJlcixcbiAgcmVmWDogbnVtYmVyLFxuICByZWZXOiBudW1iZXIsXG4gIGVsZW1XOiBudW1iZXIsXG4pOiBQbGFjZWQxRCB7XG4gIGlmIChyZWZYICsgcmVmVyArIGVsZW1XID4gdmlld3BvcnRXKSB7XG4gICAgLy8gbm90IGVub3VnaCBzcGFjZSBhZnRlciwgdHJ5IGJlZm9yZVxuICAgIGlmIChlbGVtVyA8IHJlZlgpIHtcbiAgICAgIC8vIG9rLCBwcmVwZW5kXG4gICAgICByZXR1cm4geyBvZmZzZXQ6IHJlZlggLSBlbGVtVywgbGVuOiBlbGVtVyB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBub3QgZW5vdWdoIHNwYWNlIGJlZm9yZSBvciBhZnRlciwgd2UgaGF2ZSB0byB0cmFuc2xhdGUgYW5kL29yIGV4cGFuZCAhXG4gICAgICBpZiAoZWxlbVcgPCB2aWV3cG9ydFcpIHtcbiAgICAgICAgLy8gY2FuJ3QgYXBwZW5kIG9yIHByZXBlbmQsIGJ1dCBubyBuZWVkIHRvIHNocmluay4uLiB0cmFuc2xhdGUgb25seVxuICAgICAgICBjb25zdCBkZWx0YSA9IHJlZlggKyByZWZXICsgZWxlbVcgLSB2aWV3cG9ydFc7XG4gICAgICAgIHJldHVybiB7IG9mZnNldDogcmVmWCArIHJlZlcgLSBkZWx0YSwgbGVuOiBlbGVtVyB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHsgb2Zmc2V0OiAwLCBsZW46IHZpZXdwb3J0VyB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBlbm91Z2ggc3BhY2UgdG8gYXBwZW5kXG4gICAgcmV0dXJuIHsgb2Zmc2V0OiByZWZYICsgcmVmVywgbGVuOiBlbGVtVyB9O1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwbGFjZTFEU3RhcnQoXG4gIHZpZXdwb3J0VzogbnVtYmVyLFxuICByZWZYOiBudW1iZXIsXG4gIHJlZlc6IG51bWJlcixcbiAgZWxlbVc6IG51bWJlcixcbik6IFBsYWNlZDFEIHtcbiAgaWYgKGVsZW1XID4gdmlld3BvcnRXKSB7XG4gICAgcmV0dXJuIHsgb2Zmc2V0OiAwLCBsZW46IHZpZXdwb3J0VyB9O1xuICB9XG4gIGlmIChyZWZYICsgZWxlbVcgPiB2aWV3cG9ydFcpIHtcbiAgICAvLyBub3QgZW5vdWdoIHNwYWNlIGFmdGVyLCB0cnkgYmVmb3JlXG4gICAgaWYgKGVsZW1XIDwgcmVmWCArIHJlZlcpIHtcbiAgICAgIC8vIG9rLCBwcmVwZW5kXG4gICAgICByZXR1cm4geyBvZmZzZXQ6IHJlZlggKyByZWZXIC0gZWxlbVcsIGxlbjogZWxlbVcgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gbm90IGVub3VnaCBzcGFjZSBiZWZvcmUgb3IgYWZ0ZXIsIHdlIGhhdmUgdG8gdHJhbnNsYXRlIGFuZC9vciBleHBhbmQgIVxuICAgICAgaWYgKGVsZW1XIDwgdmlld3BvcnRXKSB7XG4gICAgICAgIC8vIGNhbid0IGFwcGVuZCBvciBwcmVwZW5kLCBidXQgbm8gbmVlZCB0byBzaHJpbmsuLi4gdHJhbnNsYXRlIG9ubHlcbiAgICAgICAgY29uc3QgZGVsdGEgPSByZWZYICsgcmVmVyArIGVsZW1XIC0gdmlld3BvcnRXO1xuICAgICAgICByZXR1cm4geyBvZmZzZXQ6IHJlZlggKyByZWZXIC0gZGVsdGEsIGxlbjogZWxlbVcgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IG9mZnNldDogMCwgbGVuOiAxMCB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBlbm91Z2ggc3BhY2UgdG8gYXBwZW5kXG4gICAgcmV0dXJuIHsgb2Zmc2V0OiByZWZYLCBsZW46IGVsZW1XIH07XG4gIH1cbn1cblxuZnVuY3Rpb24gcGxhY2VDb21ib1koXG4gIHZpZXdwb3J0VzogbnVtYmVyLFxuICByZWZYOiBudW1iZXIsXG4gIHJlZlc6IG51bWJlcixcbiAgZWxlbVc6IG51bWJlcixcbik6IFBsYWNlZDFEIHtcbiAgY29uc3QgZWxlbUVuZCA9IHJlZlggKyByZWZXO1xuICBjb25zdCBzcGFjZUJlZm9yZSA9IHJlZlg7XG4gIGNvbnN0IHNwYWNlQWZ0ZXIgPSB2aWV3cG9ydFcgLSBlbGVtRW5kO1xuICBpZiAoZWxlbVcgPCBzcGFjZUFmdGVyKSB7XG4gICAgLy8gZW5vdWdoIHNwYWNlIGFmdGVyLCBhcHBlbmRcbiAgICByZXR1cm4geyBvZmZzZXQ6IGVsZW1FbmQsIGxlbjogZWxlbVcgfTtcbiAgfSBlbHNlIGlmIChlbGVtVyA8IHNwYWNlQmVmb3JlKSB7XG4gICAgLy8gZW5vdWdoIHNwYWNlIGJlZm9yZSwgYXBwZW5kXG4gICAgcmV0dXJuIHsgb2Zmc2V0OiByZWZYIC0gZWxlbVcsIGxlbjogZWxlbVcgfTtcbiAgfSBlbHNlIHtcbiAgICAvLyBub3QgZW5vdWdoIHNwYWNlLCBuZWVkIHRvIHNocmlua1xuICAgIC8vIHVzZSB0aGUgbW9zdCBzcGFjZVxuICAgIGlmIChzcGFjZUJlZm9yZSA+IHNwYWNlQWZ0ZXIpIHtcbiAgICAgIC8vIHBsYWNlIGJlZm9yZVxuICAgICAgcmV0dXJuIHsgb2Zmc2V0OiAwLCBsZW46IHNwYWNlQmVmb3JlIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7IG9mZnNldDogZWxlbUVuZCwgbGVuOiBzcGFjZUFmdGVyIH07XG4gICAgfVxuICB9XG59XG4iXX0=