/*
 * MIT License
 *
 * Copyright (c) 2019 RÃ©mi Van Keisbelck
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
import { Task } from './Task';
import { Time } from './Time';
import { expect, test, assert } from "vitest";
test('succeed', () => new Promise(done => {
    expectOk(done, Task.succeed(123), 123);
}));
test('fail', () => new Promise(done => {
    expectErr(done, Task.fail('wtf?'), 'wtf?');
}));
test('map', () => new Promise(done => {
    expectOk(done, Task.succeed(1).map((i) => i + 1), 2);
}));
test('mapError', () => new Promise(done => {
    expectErr(done, Task.fail('wtf').mapError((s) => s + ' is wrong?'), 'wtf is wrong?');
}));
test('andThen', () => new Promise(done => {
    expectOk(done, Task.succeed(1).andThen((i) => {
        return Task.succeed(i + 10);
    }), 11);
}));
test('more complex stuff', () => new Promise(done => {
    expectOk(done, Task.succeed('hello')
        .map((s) => s + ' world')
        .andThen((s) => Task.succeed(s + ' and').map((s) => s + ' people'))
        .map((s) => s + ' and dolphins'), 'hello world and people and dolphins');
}));
test('more complex stuff with err', () => new Promise(done => {
    expectErr(done, Task.fail('hello')
        .mapError((s) => s + ' world')
        .andThen((s) => Task.fail(s + ' foo')), // this should not appear ! second task never gets executed
    'hello world');
}));
test('from lambda', () => new Promise(done => {
    const t = Task.fromLambda(() => 123);
    expectOk(done, t, 123);
}));
test('parallel', () => new Promise(done => {
    const t1 = Time.in(1000).map(() => 1);
    const t2 = Time.in(2000).map(() => 2);
    const t3 = Time.in(1000).map(() => 4);
    const p = t1.parallel(t2, (a, b) => a + b).parallel(t3, (a, b) => a + b);
    const t = new Date().getTime();
    perform(p, (x) => {
        const elapsed = new Date().getTime() - t;
        expect(x).toBe(7);
        expect(elapsed < 2100).toBeTruthy();
        done();
    });
}));
test('lazy', () => new Promise(done => {
    expectOk(done, Task.succeedLazy(() => 123), 123);
    expectErr(done, Task.failLazy(() => 'kaboom'), 'kaboom');
}));
test('recover', () => new Promise(done => {
    const t = Task.fromLambda(() => {
        throw new Error('kaboom');
    }).mapError((e) => e.message);
    expectErr(done, t, 'kaboom');
    const t2 = t.recover((e) => e.length);
    expectOk(done, t2, 6);
    const t3 = t2.andThen(() => Task.succeed(123));
    expectOk(done, t3, 123);
    const t4 = t3.andThen(() => Task.fail('yalla'));
    expectErr(done, t4, 'yalla');
}));
export function attempt(t, callback) {
    Task.attempt(t, (m) => m).execute(callback);
}
export function perform(t, callback) {
    Task.perform(t, (m) => m).execute(callback);
}
export function expectOk(done, t, r) {
    attempt(t, (result) => {
        result.match((res) => expect(res).toBe(r), () => assert.fail('expected a success'));
        done();
    });
}
export function expectErr(done, t, e) {
    attempt(t, (result) => {
        result.match((_) => assert.fail('expected an error'), (err) => expect(err).toBe(e));
        done();
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGFzay50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1RlYUN1cC9UYXNrLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJHO0FBRUgsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUU5QixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzlCLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUU5QyxJQUFJLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksT0FBTyxDQUFPLElBQUksQ0FBQyxFQUFFO0lBQzdDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUN6QyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLE9BQU8sQ0FBTyxJQUFJLENBQUMsRUFBRTtJQUMxQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDN0MsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxPQUFPLENBQU8sSUFBSSxDQUFDLEVBQUU7SUFDekMsUUFBUSxDQUNOLElBQUksRUFDSixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUNqQyxDQUFDLENBQ0YsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFSixJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFB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QjtJQUNwRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzlDLENBQUM7QUFFRCxNQUFNLFVBQVUsUUFBUSxDQUFPLElBQWdCLEVBQUUsQ0FBYSxFQUFFLENBQUk7SUFDbEUsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFFO1FBQ3BCLE1BQU0sQ0FBQyxLQUFLLENBQ1YsQ0FBQyxHQUFNLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQy9CLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FDeEMsQ0FBQztRQUNGLElBQUksRUFBRSxDQUFDO0lBQ1QsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsTUFBTSxVQUFVLFNBQVMsQ0FBTyxJQUFnQixFQUFFLENBQWEsRUFBRSxDQUFJO0lBQ25FLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRTtRQUNwQixNQUFNLENBQUMsS0FBSyxDQUNWLENBQUMsQ0FBSSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEVBQzFDLENBQUMsR0FBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUNoQyxDQUFDO1FBQ0YsSUFBSSxFQUFFLENBQUM7SUFDVCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTUlUIExpY2Vuc2VcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkgUsOpbWkgVmFuIEtlaXNiZWxja1xuICpcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbiAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuICogU09GVFdBUkUuXG4gKlxuICovXG5cbmltcG9ydCB7IFRhc2sgfSBmcm9tICcuL1Rhc2snO1xuaW1wb3J0IHsgUmVzdWx0IH0gZnJvbSAnLi9SZXN1bHQnO1xuaW1wb3J0IHsgVGltZSB9IGZyb20gJy4vVGltZSc7XG5pbXBvcnQgeyBleHBlY3QsIHRlc3QsIGFzc2VydCB9IGZyb20gXCJ2aXRlc3RcIjtcblxudGVzdCgnc3VjY2VlZCcsICgpID0+IG5ldyBQcm9taXNlPHZvaWQ+KGRvbmUgPT4ge1xuICBleHBlY3RPayhkb25lLCBUYXNrLnN1Y2NlZWQoMTIzKSwgMTIzKTtcbn0pKTtcblxudGVzdCgnZmFpbCcsICgpID0+IG5ldyBQcm9taXNlPHZvaWQ+KGRvbmUgPT4ge1xuICBleHBlY3RFcnIoZG9uZSwgVGFzay5mYWlsKCd3dGY/JyksICd3dGY/Jyk7XG59KSk7XG5cbnRlc3QoJ21hcCcsICgpID0+IG5ldyBQcm9taXNlPHZvaWQ+KGRvbmUgPT4ge1xuICBleHBlY3RPayhcbiAgICBkb25lLFxuICAgIFRhc2suc3VjY2VlZCgxKS5tYXAoKGkpID0+IGkgKyAxKSxcbiAgICAyLFxuICApO1xufSkpO1xuXG50ZXN0KCdtYXBFcnJvcicsICgpID0+IG5ldyBQcm9taXNlPHZvaWQ+KGRvbmUgPT4ge1xuICBleHBlY3RFcnIoXG4gICAgZG9uZSxcbiAgICBUYXNrLmZhaWwoJ3d0ZicpLm1hcEVycm9yKChzKSA9PiBzICsgJyBpcyB3cm9uZz8nKSxcbiAgICAnd3RmIGlzIHdyb25nPycsXG4gICk7XG59KSk7XG5cbnRlc3QoJ2FuZFRoZW4nLCAoKSA9PiBuZXcgUHJvbWlzZTx2b2lkPihkb25lID0+IHtcbiAgZXhwZWN0T2soXG4gICAgZG9uZSxcbiAgICBUYXNrLnN1Y2NlZWQoMSkuYW5kVGhlbigoaTogbnVtYmVyKSA9PiB7XG4gICAgICByZXR1cm4gVGFzay5zdWNjZWVkKGkgKyAxMCk7XG4gICAgfSksXG4gICAgMTEsXG4gICk7XG59KSk7XG5cbnRlc3QoJ21vcmUgY29tcGxleCBzdHVmZicsICgpID0+IG5ldyBQcm9taXNlPHZvaWQ+KGRvbmUgPT4ge1xuICBleHBlY3RPayhcbiAgICBkb25lLFxuICAgIFRhc2suc3VjY2VlZCgnaGVsbG8nKVxuICAgICAgLm1hcCgocykgPT4gcyArICcgd29ybGQnKVxuICAgICAgLmFuZFRoZW4oKHMpID0+IFRhc2suc3VjY2VlZChzICsgJyBhbmQnKS5tYXAoKHMpID0+IHMgKyAnIHBlb3BsZScpKVxuICAgICAgLm1hcCgocykgPT4gcyArICcgYW5kIGRvbHBoaW5zJyksXG4gICAgJ2hlbGxvIHdvcmxkIGFuZCBwZW9wbGUgYW5kIGRvbHBoaW5zJyxcbiAgKTtcbn0pKTtcblxudGVzdCgnbW9yZSBjb21wbGV4IHN0dWZmIHdpdGggZXJyJywgKCkgPT4gbmV3IFByb21pc2U8dm9pZD4oZG9uZSA9PiB7XG4gIGV4cGVjdEVycihcbiAgICBkb25lLFxuICAgIFRhc2suZmFpbCgnaGVsbG8nKVxuICAgICAgLm1hcEVycm9yKChzKSA9PiBzICsgJyB3b3JsZCcpXG4gICAgICAuYW5kVGhlbigocykgPT4gVGFzay5mYWlsKHMgKyAnIGZvbycpKSwgLy8gdGhpcyBzaG91bGQgbm90IGFwcGVhciAhIHNlY29uZCB0YXNrIG5ldmVyIGdldHMgZXhlY3V0ZWRcbiAgICAnaGVsbG8gd29ybGQnLFxuICApO1xufSkpO1xuXG50ZXN0KCdmcm9tIGxhbWJkYScsICgpID0+IG5ldyBQcm9taXNlPHZvaWQ+KGRvbmUgPT4ge1xuICBjb25zdCB0OiBUYXNrPEVycm9yLCBudW1iZXI+ID0gVGFzay5mcm9tTGFtYmRhKCgpID0+IDEyMyk7XG4gIGV4cGVjdE9rKGRvbmUsIHQsIDEyMyk7XG59KSk7XG5cbnRlc3QoJ3BhcmFsbGVsJywgKCkgPT4gbmV3IFByb21pc2U8dm9pZD4oZG9uZSA9PiB7XG4gIGNvbnN0IHQxID0gVGltZS5pbigxMDAwKS5tYXAoKCkgPT4gMSk7XG4gIGNvbnN0IHQyID0gVGltZS5pbigyMDAwKS5tYXAoKCkgPT4gMik7XG4gIGNvbnN0IHQzID0gVGltZS5pbigxMDAwKS5tYXAoKCkgPT4gNCk7XG4gIGNvbnN0IHAgPSB0MS5wYXJhbGxlbCh0MiwgKGEsIGIpID0+IGEgKyBiKS5wYXJhbGxlbCh0MywgKGEsIGIpID0+IGEgKyBiKTtcbiAgY29uc3QgdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICBwZXJmb3JtKHAsICh4OiBudW1iZXIpID0+IHtcbiAgICBjb25zdCBlbGFwc2VkID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0O1xuICAgIGV4cGVjdCh4KS50b0JlKDcpO1xuICAgIGV4cGVjdChlbGFwc2VkIDwgMjEwMCkudG9CZVRydXRoeSgpO1xuICAgIGRvbmUoKTtcbiAgfSk7XG59KSk7XG5cbnRlc3QoJ2xhenknLCAoKSA9PiBuZXcgUHJvbWlzZTx2b2lkPihkb25lID0+IHtcbiAgZXhwZWN0T2soXG4gICAgZG9uZSxcbiAgICBUYXNrLnN1Y2NlZWRMYXp5KCgpID0+IDEyMyksXG4gICAgMTIzLFxuICApO1xuICBleHBlY3RFcnIoXG4gICAgZG9uZSxcbiAgICBUYXNrLmZhaWxMYXp5KCgpID0+ICdrYWJvb20nKSxcbiAgICAna2Fib29tJyxcbiAgKTtcbn0pKTtcblxudGVzdCgncmVjb3ZlcicsICgpID0+IG5ldyBQcm9taXNlPHZvaWQ+KGRvbmUgPT4ge1xuICBjb25zdCB0OiBUYXNrPHN0cmluZywgbnVtYmVyPiA9IFRhc2suZnJvbUxhbWJkYSgoKSA9PiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdrYWJvb20nKTtcbiAgfSkubWFwRXJyb3IoKGUpID0+IGUubWVzc2FnZSk7XG4gIGV4cGVjdEVycihkb25lLCB0LCAna2Fib29tJyk7XG4gIGNvbnN0IHQyOiBUYXNrPG5ldmVyLCBudW1iZXI+ID0gdC5yZWNvdmVyKChlKSA9PiBlLmxlbmd0aCk7XG4gIGV4cGVjdE9rKGRvbmUsIHQyLCA2KTtcbiAgY29uc3QgdDM6IFRhc2s8c3RyaW5nLCBudW1iZXI+ID0gdDIuYW5kVGhlbigoKSA9PiBUYXNrLnN1Y2NlZWQoMTIzKSk7XG4gIGV4cGVjdE9rKGRvbmUsIHQzLCAxMjMpO1xuICBjb25zdCB0NDogVGFzazxzdHJpbmcsIG51bWJlcj4gPSB0My5hbmRUaGVuKCgpID0+IFRhc2suZmFpbCgneWFsbGEnKSk7XG4gIGV4cGVjdEVycihkb25lLCB0NCwgJ3lhbGxhJyk7XG59KSk7XG5cbmV4cG9ydCBmdW5jdGlvbiBhdHRlbXB0PEUsIFI+KHQ6IFRhc2s8RSwgUj4sIGNhbGxiYWNrOiAocjogUmVzdWx0PEUsIFI+KSA9PiB2b2lkKSB7XG4gIFRhc2suYXR0ZW1wdCh0LCAobSkgPT4gbSkuZXhlY3V0ZShjYWxsYmFjayk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwZXJmb3JtPFI+KHQ6IFRhc2s8bmV2ZXIsIFI+LCBjYWxsYmFjazogKHI6IFIpID0+IHZvaWQpIHtcbiAgVGFzay5wZXJmb3JtKHQsIChtKSA9PiBtKS5leGVjdXRlKGNhbGxiYWNrKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4cGVjdE9rPEUsIFI+KGRvbmU6ICgpID0+IHZvaWQsIHQ6IFRhc2s8RSwgUj4sIHI6IFIpIHtcbiAgYXR0ZW1wdCh0LCAocmVzdWx0KSA9PiB7XG4gICAgcmVzdWx0Lm1hdGNoKFxuICAgICAgKHJlczogUikgPT4gZXhwZWN0KHJlcykudG9CZShyKSxcbiAgICAgICgpID0+IGFzc2VydC5mYWlsKCdleHBlY3RlZCBhIHN1Y2Nlc3MnKSxcbiAgICApO1xuICAgIGRvbmUoKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHBlY3RFcnI8RSwgUj4oZG9uZTogKCkgPT4gdm9pZCwgdDogVGFzazxFLCBSPiwgZTogRSkge1xuICBhdHRlbXB0KHQsIChyZXN1bHQpID0+IHtcbiAgICByZXN1bHQubWF0Y2goXG4gICAgICAoXzogUikgPT4gYXNzZXJ0LmZhaWwoJ2V4cGVjdGVkIGFuIGVycm9yJyksXG4gICAgICAoZXJyOiBFKSA9PiBleHBlY3QoZXJyKS50b0JlKGUpLFxuICAgICk7XG4gICAgZG9uZSgpO1xuICB9KTtcbn1cbiJdfQ==