/*
 * MIT License
 *
 * Copyright (c) 2019 RÃ©mi Van Keisbelck
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
export class Sub {
    constructor() {
        this.active = false;
    }
    static none() {
        return new SubNone();
    }
    static batch(subs) {
        return new BatchSub(subs);
    }
    init(dispatch) {
        this.dispatcher = dispatch;
        this.active = true;
        this.onInit();
    }
    release() {
        this.active = false;
        this.onRelease();
    }
    isActive() {
        return this.active;
    }
    dispatch(m) {
        var _a;
        (_a = this.dispatcher) === null || _a === void 0 ? void 0 : _a.call(this, m);
    }
    onInit() { }
    onRelease() { }
    map(f) {
        return new MappedSub(this, f);
    }
}
class SubNone extends Sub {
}
class BatchSub extends Sub {
    constructor(subs) {
        super();
        this.subs = subs;
    }
    init(dispatch) {
        this.subs.forEach((s) => s.init(dispatch));
    }
    release() {
        this.subs.forEach((s) => s.release());
    }
}
class MappedSub extends Sub {
    constructor(childSub, mapper) {
        super();
        this.childSub = childSub;
        this.mapper = mapper;
    }
    init(dispatch) {
        this.childSub.init((m) => {
            dispatch(this.mapper(m));
        });
    }
    release() {
        this.childSub.release();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3ViLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1RlYUN1cC9TdWIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJHO0FBSUgsTUFBTSxPQUFnQixHQUFHO0lBQXpCO1FBRVUsV0FBTSxHQUFZLEtBQUssQ0FBQztJQW9DbEMsQ0FBQztJQWxDQyxNQUFNLENBQUMsSUFBSTtRQUNULE9BQU8sSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBTSxJQUFxQjtRQUNyQyxPQUFPLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRCxJQUFJLENBQUMsUUFBeUI7UUFDNUIsSUFBSSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUM7UUFDM0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDcEIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFFRCxRQUFRO1FBQ04sT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JCLENBQUM7SUFFUyxRQUFRLENBQUMsQ0FBTTs7UUFDdkIsTUFBQSxJQUFJLENBQUMsVUFBVSxxREFBRyxDQUFDLENBQUMsQ0FBQztJQUN2QixDQUFDO0lBRVMsTUFBTSxLQUFJLENBQUM7SUFFWCxTQUFTLEtBQUksQ0FBQztJQUV4QixHQUFHLENBQVksQ0FBd0I7UUFDckMsT0FBTyxJQUFJLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDaEMsQ0FBQztDQUNGO0FBRUQsTUFBTSxPQUFhLFNBQVEsR0FBUTtDQUFHO0FBRXRDLE1BQU0sUUFBYyxTQUFRLEdBQVE7SUFHbEMsWUFBWSxJQUFxQjtRQUMvQixLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ25CLENBQUM7SUFFRCxJQUFJLENBQUMsUUFBeUI7UUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQsT0FBTztRQUNMLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUN4QyxDQUFDO0NBQ0Y7QUFFRCxNQUFNLFNBQTBCLFNBQVEsR0FBYztJQUlwRCxZQUFZLFFBQWtCLEVBQUUsTUFBOEI7UUFDNUQsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUN6QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQsSUFBSSxDQUFDLFFBQStCO1FBQ2xDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBTSxFQUFFLEVBQUU7WUFDNUIsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUMxQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTUlUIExpY2Vuc2VcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkgUsOpbWkgVmFuIEtlaXNiZWxja1xuICpcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbiAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuICogU09GVFdBUkUuXG4gKlxuICovXG5cbmltcG9ydCB7IERpc3BhdGNoZXIgfSBmcm9tICcuL0Rpc3BhdGNoZXInO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgU3ViPE1zZz4ge1xuICBwcm90ZWN0ZWQgZGlzcGF0Y2hlcjogRGlzcGF0Y2hlcjxNc2c+IHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIGFjdGl2ZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHN0YXRpYyBub25lPE1zZz4oKTogU3ViPE1zZz4ge1xuICAgIHJldHVybiBuZXcgU3ViTm9uZSgpO1xuICB9XG5cbiAgc3RhdGljIGJhdGNoPE1zZz4oc3ViczogQXJyYXk8U3ViPE1zZz4+KTogU3ViPE1zZz4ge1xuICAgIHJldHVybiBuZXcgQmF0Y2hTdWIoc3Vicyk7XG4gIH1cblxuICBpbml0KGRpc3BhdGNoOiBEaXNwYXRjaGVyPE1zZz4pOiB2b2lkIHtcbiAgICB0aGlzLmRpc3BhdGNoZXIgPSBkaXNwYXRjaDtcbiAgICB0aGlzLmFjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5vbkluaXQoKTtcbiAgfVxuXG4gIHJlbGVhc2UoKTogdm9pZCB7XG4gICAgdGhpcy5hY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLm9uUmVsZWFzZSgpO1xuICB9XG5cbiAgaXNBY3RpdmUoKSB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlO1xuICB9XG5cbiAgcHJvdGVjdGVkIGRpc3BhdGNoKG06IE1zZyk6IHZvaWQge1xuICAgIHRoaXMuZGlzcGF0Y2hlcj8uKG0pO1xuICB9XG5cbiAgcHJvdGVjdGVkIG9uSW5pdCgpIHt9XG5cbiAgcHJvdGVjdGVkIG9uUmVsZWFzZSgpIHt9XG5cbiAgbWFwPFBhcmVudE1zZz4oZjogKG06IE1zZykgPT4gUGFyZW50TXNnKTogU3ViPFBhcmVudE1zZz4ge1xuICAgIHJldHVybiBuZXcgTWFwcGVkU3ViKHRoaXMsIGYpO1xuICB9XG59XG5cbmNsYXNzIFN1Yk5vbmU8TXNnPiBleHRlbmRzIFN1YjxNc2c+IHt9XG5cbmNsYXNzIEJhdGNoU3ViPE1zZz4gZXh0ZW5kcyBTdWI8TXNnPiB7XG4gIHByaXZhdGUgcmVhZG9ubHkgc3ViczogQXJyYXk8U3ViPE1zZz4+O1xuXG4gIGNvbnN0cnVjdG9yKHN1YnM6IEFycmF5PFN1YjxNc2c+Pikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5zdWJzID0gc3VicztcbiAgfVxuXG4gIGluaXQoZGlzcGF0Y2g6IERpc3BhdGNoZXI8TXNnPik6IHZvaWQge1xuICAgIHRoaXMuc3Vicy5mb3JFYWNoKChzKSA9PiBzLmluaXQoZGlzcGF0Y2gpKTtcbiAgfVxuXG4gIHJlbGVhc2UoKTogdm9pZCB7XG4gICAgdGhpcy5zdWJzLmZvckVhY2goKHMpID0+IHMucmVsZWFzZSgpKTtcbiAgfVxufVxuXG5jbGFzcyBNYXBwZWRTdWI8TXNnLCBQYXJlbnRNc2c+IGV4dGVuZHMgU3ViPFBhcmVudE1zZz4ge1xuICBwcml2YXRlIHJlYWRvbmx5IGNoaWxkU3ViOiBTdWI8TXNnPjtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXBwZXI6IChjbTogTXNnKSA9PiBQYXJlbnRNc2c7XG5cbiAgY29uc3RydWN0b3IoY2hpbGRTdWI6IFN1YjxNc2c+LCBtYXBwZXI6IChjbTogTXNnKSA9PiBQYXJlbnRNc2cpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuY2hpbGRTdWIgPSBjaGlsZFN1YjtcbiAgICB0aGlzLm1hcHBlciA9IG1hcHBlcjtcbiAgfVxuXG4gIGluaXQoZGlzcGF0Y2g6IERpc3BhdGNoZXI8UGFyZW50TXNnPik6IHZvaWQge1xuICAgIHRoaXMuY2hpbGRTdWIuaW5pdCgobTogTXNnKSA9PiB7XG4gICAgICBkaXNwYXRjaCh0aGlzLm1hcHBlcihtKSk7XG4gICAgfSk7XG4gIH1cblxuICByZWxlYXNlKCk6IHZvaWQge1xuICAgIHRoaXMuY2hpbGRTdWIucmVsZWFzZSgpO1xuICB9XG59XG4iXX0=