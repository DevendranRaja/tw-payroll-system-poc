/*
 * MIT License
 *
 * Copyright (c) 2019 RÃ©mi Van Keisbelck
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
import { memoize } from "./Memoize";
import { beforeEach, describe, expect, test } from "vitest";
describe('memoize function', () => {
    let count = 0;
    function invoke(f, arg, expectedResult, expectedCount) {
        const r = f(arg);
        expect(r).toEqual(expectedResult);
        expect(count).toEqual(expectedCount);
    }
    beforeEach(() => {
        count = 0;
    });
    test("primitive number", () => {
        const f = memoize((x) => {
            count++;
            return x + 1;
        });
        [
            [0, 1, 1],
            [1, 2, 2],
            [1, 2, 2],
            [0, 1, 3],
            [0, 1, 3]
        ].forEach(([v, er, ec]) => {
            invoke(f, v, er, ec);
        });
    });
    test("object ref equality", () => {
        const f_ = u => {
            count++;
            return u.name + " " + u.size;
        };
        const f = memoize(f_);
        const user = {
            name: "John",
            size: 48,
        };
        invoke(f, user, "John 48", 1);
        invoke(f, user, "John 48", 1);
        const user2 = Object.assign(Object.assign({}, user), { size: 12 });
        invoke(f, user2, "John 12", 2);
        invoke(f, user2, "John 12", 2);
    });
    test("object with compare fn", () => {
        const f_ = u => {
            count++;
            return u.name + " " + u.size;
        };
        const f = memoize(f_, (o1, o2) => o1.name === o2.name && o1.size === o2.size);
        const user = {
            name: "John",
            size: 48,
        };
        invoke(f, user, "John 48", 1);
        invoke(f, Object.assign({}, user), "John 48", 1);
        invoke(f, { name: "John", size: 48 }, "John 48", 1);
    });
    test("array ref equals", () => {
        const f_ = a => {
            count++;
            return a.join("_");
        };
        const f = memoize(f_);
        const a = [1, 2, 3];
        invoke(f, a, "1_2_3", 1);
        invoke(f, a, "1_2_3", 1);
        const a2 = [...a, 4];
        invoke(f, a2, "1_2_3_4", 2);
        invoke(f, a2, "1_2_3_4", 2);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVtb2l6ZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1RlYUN1cC9NZW1vaXplLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJHO0FBR0gsT0FBTyxFQUFDLE9BQU8sRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNsQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBTzVELFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7SUFFaEMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBRWQsU0FBUyxNQUFNLENBQU0sQ0FBYyxFQUFFLEdBQUssRUFBRSxjQUFpQixFQUFFLGFBQXFCO1FBQ2xGLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVELFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ1osQ0FBQyxDQUFDLENBQUE7SUFFRixJQUFJLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQzVCLE1BQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQVMsRUFBRSxFQUFFO1lBQzlCLEtBQUssRUFBRSxDQUFDO1lBQ1IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsQ0FBQyxDQUFDLENBQUM7UUFDSDtZQUNFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDVCxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ1QsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxF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QUFDLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN6QixNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDekIsTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNyQixNQUFNLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDNUIsTUFBTSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzlCLENBQUMsQ0FBQyxDQUFDO0FBRUwsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTUlUIExpY2Vuc2VcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkgUsOpbWkgVmFuIEtlaXNiZWxja1xuICpcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbiAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuICogU09GVFdBUkUuXG4gKlxuICovXG5cblxuaW1wb3J0IHttZW1vaXplfSBmcm9tIFwiLi9NZW1vaXplXCI7XG5pbXBvcnQgeyBiZWZvcmVFYWNoLCBkZXNjcmliZSwgZXhwZWN0LCB0ZXN0IH0gZnJvbSBcInZpdGVzdFwiO1xuXG5pbnRlcmZhY2UgVXNlciB7XG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgcmVhZG9ubHkgc2l6ZTogbnVtYmVyO1xufVxuXG5kZXNjcmliZSgnbWVtb2l6ZSBmdW5jdGlvbicsICgpID0+IHtcblxuICBsZXQgY291bnQgPSAwO1xuXG4gIGZ1bmN0aW9uIGludm9rZTxULFI+KGY6ICh0OiBUKSA9PiBSLCBhcmc6VCwgZXhwZWN0ZWRSZXN1bHQ6IFIsIGV4cGVjdGVkQ291bnQ6IG51bWJlcikge1xuICAgIGNvbnN0IHIgPSBmKGFyZyk7XG4gICAgZXhwZWN0KHIpLnRvRXF1YWwoZXhwZWN0ZWRSZXN1bHQpO1xuICAgIGV4cGVjdChjb3VudCkudG9FcXVhbChleHBlY3RlZENvdW50KTtcbiAgfVxuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGNvdW50ID0gMDtcbiAgfSlcblxuICB0ZXN0KFwicHJpbWl0aXZlIG51bWJlclwiLCAoKSA9PiB7XG4gICAgY29uc3QgZiA9IG1lbW9pemUoKHg6IG51bWJlcikgPT4ge1xuICAgICAgY291bnQrKztcbiAgICAgIHJldHVybiB4ICsgMTtcbiAgICB9KTtcbiAgICBbXG4gICAgICBbMCwgMSwgMV0sXG4gICAgICBbMSwgMiwgMl0sXG4gICAgICBbMSwgMiwgMl0sXG4gICAgICBbMCwgMSwgM10sXG4gICAgICBbMCwgMSwgM11cbiAgICBdLmZvckVhY2goKFt2LCBlciwgZWNdKSA9PiB7XG4gICAgICBpbnZva2UoZiwgdiwgZXIsIGVjKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdChcIm9iamVjdCByZWYgZXF1YWxpdHlcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZfOiAodXNlcjogVXNlcikgPT4gc3RyaW5nID0gdSA9PiB7XG4gICAgICBjb3VudCsrO1xuICAgICAgcmV0dXJuIHUubmFtZSArIFwiIFwiICsgdS5zaXplO1xuICAgIH1cbiAgICBjb25zdCBmID0gbWVtb2l6ZShmXyk7XG4gICAgY29uc3QgdXNlcjogVXNlciA9IHtcbiAgICAgIG5hbWU6IFwiSm9oblwiLFxuICAgICAgc2l6ZTogNDgsXG4gICAgfTtcbiAgICBpbnZva2UoZiwgdXNlciwgXCJKb2huIDQ4XCIsIDEpO1xuICAgIGludm9rZShmLCB1c2VyLCBcIkpvaG4gNDhcIiwgMSk7XG4gICAgY29uc3QgdXNlcjI6IFVzZXIgPSB7XG4gICAgICAuLi51c2VyLFxuICAgICAgc2l6ZTogMTIsXG4gICAgfTtcbiAgICBpbnZva2UoZiwgdXNlcjIsIFwiSm9obiAxMlwiLCAyKTtcbiAgICBpbnZva2UoZiwgdXNlcjIsIFwiSm9obiAxMlwiLCAyKTtcbiAgfSk7XG5cbiAgdGVzdChcIm9iamVjdCB3aXRoIGNvbXBhcmUgZm5cIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZfOiAodXNlcjogVXNlcikgPT4gc3RyaW5nID0gdSA9PiB7XG4gICAgICBjb3VudCsrO1xuICAgICAgcmV0dXJuIHUubmFtZSArIFwiIFwiICsgdS5zaXplO1xuICAgIH1cbiAgICBjb25zdCBmID0gbWVtb2l6ZShmXywgKG8xLCBvMikgPT4gbzEubmFtZSA9PT0gbzIubmFtZSAmJiBvMS5zaXplID09PSBvMi5zaXplKTtcbiAgICBjb25zdCB1c2VyOiBVc2VyID0ge1xuICAgICAgbmFtZTogXCJKb2huXCIsXG4gICAgICBzaXplOiA0OCxcbiAgICB9O1xuICAgIGludm9rZShmLCB1c2VyLCBcIkpvaG4gNDhcIiwgMSk7XG4gICAgaW52b2tlKGYsIHsgLi4udXNlciB9LCBcIkpvaG4gNDhcIiwgMSk7XG4gICAgaW52b2tlKGYsIHsgbmFtZTogXCJKb2huXCIsIHNpemU6IDQ4IH0sIFwiSm9obiA0OFwiLCAxKTtcbiAgfSk7XG5cbiAgdGVzdChcImFycmF5IHJlZiBlcXVhbHNcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZfOiAoYTogbnVtYmVyW10pID0+IHN0cmluZyA9IGEgPT4ge1xuICAgICAgY291bnQrKztcbiAgICAgIHJldHVybiBhLmpvaW4oXCJfXCIpO1xuICAgIH1cbiAgICBjb25zdCBmID0gbWVtb2l6ZShmXyk7XG4gICAgY29uc3QgYSA9IFsxLCAyLCAzXTtcbiAgICBpbnZva2UoZiwgYSwgXCIxXzJfM1wiLCAxKTtcbiAgICBpbnZva2UoZiwgYSwgXCIxXzJfM1wiLCAxKTtcbiAgICBjb25zdCBhMiA9IFsuLi5hLCA0XTtcbiAgICBpbnZva2UoZiwgYTIsIFwiMV8yXzNfNFwiLCAyKTtcbiAgICBpbnZva2UoZiwgYTIsIFwiMV8yXzNfNFwiLCAyKTtcbiAgfSk7XG5cbn0pO1xuIl19