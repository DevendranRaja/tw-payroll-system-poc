/*
 * MIT License
 *
 * Copyright (c) 2024 RÃ©mi Van Keisbelck, Frank Wagner
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
import { describe, expect, test } from "vitest";
import { discriminate, idLens } from "./Lens";
import { just, nothing } from "./Maybe";
describe("lens", () => {
    test("id", () => {
        const lens = idLens();
        expect(lens.get("foo")).toEqual("foo");
        expect(lens.update("foo", (a) => a + "bar")).toEqual("foobar");
    });
    test("id with result", () => {
        const lens = idLens();
        expect(lens.get("foo")).toEqual("foo");
        expect(lens.updateWithResult("foo", (a) => [a + "bar", 123])).toEqual([
            "foobar",
            123,
        ]);
    });
    test("field", () => {
        const StreetNameLens = idLens().field("name");
        const street = { name: "main street", number: 42 };
        expect(StreetNameLens.get(street)).toEqual("main street");
        expect(StreetNameLens.update(street, (n) => "small " + n)).toEqual({
            name: "small main street",
            number: 42,
        });
    });
    test("field with result", () => {
        const StreetNameLens = idLens().field("name");
        const street = { name: "main street", number: 42 };
        expect(StreetNameLens.get(street)).toEqual("main street");
        expect(StreetNameLens.updateWithResult(street, (n) => ["small " + n, "yalla"])).toEqual([{ name: "small main street", number: 42 }, "yalla"]);
    });
    test("deeper", () => {
        const AdressStreetNameLens = idLens()
            .field("street")
            .field("name");
        const address = {
            street: { name: "main street", number: 42 },
            city: { name: "Big", zip: "4242" },
        };
        expect(AdressStreetNameLens.get(address)).toEqual("main street");
        expect(AdressStreetNameLens.update(address, (n) => "small " + n)).toEqual({
            street: { name: "small main street", number: 42 },
            city: { name: "Big", zip: "4242" },
        });
    });
    test("deeper with result", () => {
        const AdressStreetNameLens = idLens()
            .field("street")
            .field("name");
        const address = {
            street: { name: "main street", number: 42 },
            city: { name: "Big", zip: "4242" },
        };
        expect(AdressStreetNameLens.get(address)).toEqual("main street");
        expect(AdressStreetNameLens.updateWithResult(address, (n) => ["small " + n, 123])).toEqual([
            {
                street: { name: "small main street", number: 42 },
                city: { name: "Big", zip: "4242" },
            },
            123,
        ]);
    });
    test("discriminated guard s", () => {
        const d = discriminate("tag", "user");
        const userPage = { tag: "user", user: "gnu" };
        const homePage = { tag: "home" };
        expect(d(userPage)).toEqual(just(userPage));
        expect(d(homePage)).toEqual(nothing);
    });
    test("discriminated guard with several tags", () => {
        const d = discriminate("tag", "user");
        const d2 = discriminate("tag2", "user2");
        const userPage = { tag: "user", tag2: "user2", user: "gnu" };
        const homePage = { tag: "home", tag2: "home2" };
        expect(d(userPage)).toEqual(just(userPage));
        expect(d(homePage)).toEqual(nothing);
        expect(d2(userPage)).toEqual(just(userPage));
        expect(d2(homePage)).toEqual(nothing);
    });
    test("discriminated sub type prism", () => {
        const UserPageUserPrism = idLens().sub(discriminate("tag", "user"));
        const userPage = { tag: "user", user: "gnu" };
        const homePage = { tag: "home" };
        expect(UserPageUserPrism.get(userPage)).toEqual(just(userPage));
        expect(UserPageUserPrism.get(homePage)).toEqual(nothing);
        expect(UserPageUserPrism.update(userPage, (u) => (Object.assign(Object.assign({}, u), { user: "gnu!" })))).toEqual(just({ tag: "user", user: "gnu!" }));
        expect(UserPageUserPrism.update(homePage, (u) => (Object.assign(Object.assign({}, u), { user: "gnu!" })))).toEqual(nothing);
    });
    test("discriminated sub type prism with result", () => {
        const UserPageUserPrism = idLens().sub(discriminate("tag", "user"));
        const userPage = { tag: "user", user: "gnu" };
        const homePage = { tag: "home" };
        expect(UserPageUserPrism.get(userPage)).toEqual(just(userPage));
        expect(UserPageUserPrism.get(homePage)).toEqual(nothing);
        expect(UserPageUserPrism.updateWithResult(userPage, (u) => [
            Object.assign(Object.assign({}, u), { user: "gnu!" }),
            123,
        ])).toEqual(just([{ tag: "user", user: "gnu!" }, 123]));
        expect(UserPageUserPrism.updateWithResult(homePage, (u) => [
            Object.assign(Object.assign({}, u), { user: "gnu!" }),
            123,
        ])).toEqual(nothing);
    });
    const player = {
        tag: "player",
        tab: {
            tag: "artists",
            count: 123,
        },
    };
    const playerHome = {
        tag: "home",
    };
    const playerAlbums = {
        tag: "player",
        tab: {
            tag: "albums",
        },
    };
    test("discriminated sub type field prism", () => {
        // const UserPageUserPrism = idLens<Page>().sub(p => p.tag === 'user' ? p as UserPage : undefined).field('user')
        const UserPageUserPrism = idLens().sub(discriminate("tag", "user")).field("user");
        // WONTWORK
        // const UserPageUserPrism2 = idLens<Page>().sub(Lenses.descriminate('tag', 'user')).field('user')
        const userPage = { tag: "user", user: "gnu" };
        const homePage = { tag: "home" };
        expect(UserPageUserPrism.get(userPage)).toEqual(just("gnu"));
        expect(UserPageUserPrism.get(homePage)).toEqual(nothing);
        expect(UserPageUserPrism.update(userPage, (u) => u + "!")).toEqual(just({ tag: "user", user: "gnu!" }));
        expect(UserPageUserPrism.update(homePage, (u) => u + "!")).toEqual(nothing);
    });
    test("discriminated sub twice", () => {
        const ArtistsPrism = idLens()
            .sub(discriminate("tag", "player"))
            .field("tab")
            .sub(discriminate("tag", "artists"))
            .field("count");
        expect(ArtistsPrism.get(player)).toEqual(just(123));
        expect(ArtistsPrism.get(playerHome)).toEqual(nothing);
        expect(ArtistsPrism.get(playerAlbums)).toEqual(nothing);
        expect(ArtistsPrism.update(player, (c) => c + 1)).toEqual(just({
            tag: "player",
            tab: {
                tag: "artists",
                count: 124,
            },
        }));
        expect(ArtistsPrism.update(playerHome, (c) => c + 1)).toEqual(nothing);
        expect(ArtistsPrism.update(playerAlbums, (c) => c + 1)).toEqual(nothing);
    });
    test("discriminated sub twice with result", () => {
        const ArtistsPrism = idLens()
            .sub(discriminate("tag", "player"))
            .field("tab")
            .sub(discriminate("tag", "artists"))
            .field("count");
        expect(ArtistsPrism.updateWithResult(player, (c) => [c + 1, 123])).toEqual(just([
            {
                tag: "player",
                tab: {
                    tag: "artists",
                    count: 124,
                },
            },
            123,
        ]));
        expect(ArtistsPrism.updateWithResult(playerHome, (c) => [c + 1, 123])).toEqual(nothing);
        expect(ArtistsPrism.updateWithResult(playerAlbums, (c) => [c + 1, 123])).toEqual(nothing);
    });
    test("compose lenses", () => {
        const streetLens = idLens().field("street");
        const nameLens = idLens().field("name");
        const composed = streetLens.andThenLens(nameLens);
        const address = {
            street: { name: "main street", number: 42 },
            city: { name: "Big", zip: "4242" },
        };
        expect(composed.get(address)).toEqual("main street");
        expect(composed.update(address, (n) => "small " + n)).toEqual({
            street: { name: "small main street", number: 42 },
            city: { name: "Big", zip: "4242" },
        });
    });
    test("compose lenses with result", () => {
        const streetLens = idLens().field("street");
        const nameLens = idLens().field("name");
        const composed = streetLens.andThenLens(nameLens);
        const address = {
            street: { name: "main street", number: 42 },
            city: { name: "Big", zip: "4242" },
        };
        expect(composed.updateWithResult(address, (n) => ["small " + n, true])).toEqual([
            {
                street: { name: "small main street", number: 42 },
                city: { name: "Big", zip: "4242" },
            },
            true,
        ]);
    });
    test("compose prism and lens", () => {
        const p = idLens().sub(discriminate("tag", "user"));
        const l = idLens().field("user");
        const composed = p.andThen(l);
        const userPage = { tag: "user", user: "gnu" };
        const homePage = { tag: "home" };
        expect(composed.get(userPage)).toEqual(just("gnu"));
        expect(composed.get(homePage)).toEqual(nothing);
        expect(composed.update(userPage, (u) => u + "!")).toEqual(just({ tag: "user", user: "gnu!" }));
        expect(composed.update(homePage, (u) => u + "!")).toEqual(nothing);
    });
    test("compose prism and lens with result", () => {
        const p = idLens().sub(discriminate("tag", "user"));
        const l = idLens().field("user");
        const composed = p.andThen(l);
        const userPage = { tag: "user", user: "gnu" };
        const homePage = { tag: "home" };
        expect(composed.get(userPage)).toEqual(just("gnu"));
        expect(composed.get(homePage)).toEqual(nothing);
        expect(composed.updateWithResult(userPage, (u) => [u + "!", false])).toEqual(just([{ tag: "user", user: "gnu!" }, false]));
        expect(composed.updateWithResult(homePage, (u) => [u + "!", false])).toEqual(nothing);
    });
    test("compose prisms", () => {
        const p1 = idLens().sub(discriminate("tag", "player"));
        const p2 = idLens()
            .field("tab")
            .sub(discriminate("tag", "artists"));
        const composed = p1.andThen(p2);
        expect(composed.updateWithResult(player, (c) => [Object.assign(Object.assign({}, c), { count: 456 }), false])).toEqual(just([
            {
                tag: "player",
                tab: {
                    tag: "artists",
                    count: 456,
                },
            },
            false,
        ]));
        expect(composed.updateWithResult(playerHome, (c) => [Object.assign(Object.assign({}, c), { count: 456 }), 123])).toEqual(nothing);
        expect(composed.updateWithResult(playerAlbums, (c) => [
            Object.assign(Object.assign({}, c), { count: 456 }),
            123,
        ])).toEqual(nothing);
    });
    const app1 = {
        page: just({
            tag: "home",
        }),
    };
    const app2 = {
        page: nothing,
    };
    test("flatten field maybe", () => {
        const l = idLens().field("page").flatten();
        expect(l.get(app1)).toEqual(just({ tag: "home" }));
        expect(l.get(app2)).toEqual(nothing);
        expect(l.update(app1, () => ({ tag: "user", user: "foobar" }))).toEqual(just({
            page: just({ tag: "user", user: "foobar" }),
        }));
        expect(l.update(app2, () => ({ tag: "user", user: "foobar" }))).toEqual(nothing);
    });
    test("set maybe field", () => {
        const l = idLens().field("page");
        expect(l.get(app1)).toEqual(just({
            tag: "home",
        }));
        expect(l.update(app1, () => nothing)).toEqual({
            page: nothing,
        });
    });
    test("flatten prisms", () => {
        const p = idLens().sub(discriminate("tag", "more"));
        const l = idLens().field("more");
        const flattened = p.andThen(l).flatten();
        // const compileError1 = idLens<Page>().flatten().set({ tag: "home" }, 13);
        // const compileError1 = idLens<Page>().flatten().get({ tag: "home" }).withDefault(13);
        const morePage1 = { tag: "more", more: nothing };
        const morePage2 = { tag: "more", more: just("gnu") };
        const homePage = { tag: "home" };
        expect(flattened.get(morePage1)).toEqual(nothing);
        expect(flattened.get(morePage2)).toEqual(just("gnu"));
        expect(flattened.get(homePage)).toEqual(nothing);
        expect(flattened.update(morePage1, (u) => u + "!")).toEqual(nothing);
        expect(flattened.update(morePage2, (u) => u + "!")).toEqual(just({ tag: "more", more: just("gnu!") }));
        expect(flattened.update(homePage, (u) => u + "!")).toEqual(nothing);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTGVucy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1RlYUN1cC9MZW5zLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJHO0FBRUgsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ2hELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFnQixNQUFNLFFBQVEsQ0FBQztBQUM1RCxPQUFPLEVBQUUsSUFBSSxFQUFTLE9BQU8sRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUUvQyxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRTtJQUNwQixJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRTtRQUNkLE1BQU0sSUFBSSxHQUFHLE1BQU0sRUFBVSxDQUFDO1FBQzlCLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2pFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtRQUMxQixNQUFNLElBQUksR0FBRyxNQUFNLEVBQVUsQ0FBQztRQUM5QixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2QyxNQUFNLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxFQUFFLEdB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RUFBMkU7UUFDM0UsdUZBQXVGO1FBRXZGLE1BQU0sU0FBUyxHQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUM7UUFDdkQsTUFBTSxTQUFTLEdBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUMzRCxNQUFNLFFBQVEsR0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQztRQUV2QyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNsRCxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUN0RCxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVqRCxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyRSxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDekQsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FDMUMsQ0FBQztRQUNGLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3RFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTUlUIExpY2Vuc2VcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMjQgUsOpbWkgVmFuIEtlaXNiZWxjaywgRnJhbmsgV2FnbmVyXG4gKlxuICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuICogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4gKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuICpcbiAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuICogY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbiAqXG4gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG4gKiBTT0ZUV0FSRS5cbiAqXG4gKi9cblxuaW1wb3J0IHsgZGVzY3JpYmUsIGV4cGVjdCwgdGVzdCB9IGZyb20gXCJ2aXRlc3RcIjtcbmltcG9ydCB7IGRpc2NyaW1pbmF0ZSwgaWRMZW5zLCBTdWJUeXBlR3VhcmQgfSBmcm9tIFwiLi9MZW5zXCI7XG5pbXBvcnQgeyBqdXN0LCBNYXliZSwgbm90aGluZyB9IGZyb20gXCIuL01heWJlXCI7XG5cbmRlc2NyaWJlKFwibGVuc1wiLCAoKSA9PiB7XG4gIHRlc3QoXCJpZFwiLCAoKSA9PiB7XG4gICAgY29uc3QgbGVucyA9IGlkTGVuczxzdHJpbmc+KCk7XG4gICAgZXhwZWN0KGxlbnMuZ2V0KFwiZm9vXCIpKS50b0VxdWFsKFwiZm9vXCIpO1xuICAgIGV4cGVjdChsZW5zLnVwZGF0ZShcImZvb1wiLCAoYSkgPT4gYSArIFwiYmFyXCIpKS50b0VxdWFsKFwiZm9vYmFyXCIpO1xuICB9KTtcblxuICB0ZXN0KFwiaWQgd2l0aCByZXN1bHRcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGxlbnMgPSBpZExlbnM8c3RyaW5nPigpO1xuICAgIGV4cGVjdChsZW5zLmdldChcImZvb1wiKSkudG9FcXVhbChcImZvb1wiKTtcbiAgICBleHBlY3QobGVucy51cGRhdGVXaXRoUmVzdWx0KFwiZm9vXCIsIChhKSA9PiBbYSArIFwiYmFyXCIsIDEyM10pKS50b0VxdWFsKFtcbiAgICAgIFwiZm9vYmFyXCIsXG4gICAgICAxMjMsXG4gICAgXSk7XG4gIH0pO1xuXG4gIHRlc3QoXCJmaWVsZFwiLCAoKSA9PiB7XG4gICAgY29uc3QgU3RyZWV0TmFtZUxlbnMgPSBpZExlbnM8U3RyZWV0PigpLmZpZWxkKFwibmFtZVwiKTtcbiAgICBjb25zdCBzdHJlZXQ6IFN0cmVldCA9IHsgbmFtZTogXCJtYWluIHN0cmVldFwiLCBudW1iZXI6IDQyIH07XG4gICAgZXhwZWN0KFN0cmVldE5hbWVMZW5zLmdldChzdHJlZXQpKS50b0VxdWFsKFwibWFpbiBzdHJlZXRcIik7XG4gICAgZXhwZWN0KFN0cmVldE5hbWVMZW5zLnVwZGF0ZShzdHJlZXQsIChuKSA9PiBcInNtYWxsIFwiICsgbikpLnRvRXF1YWwoe1xuICAgICAgbmFtZTogXCJzbWFsbCBtYWluIHN0cmVldFwiLFxuICAgICAgbnVtYmVyOiA0MixcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdChcImZpZWxkIHdpdGggcmVzdWx0XCIsICgpID0+IHtcbiAgICBjb25zdCBTdHJlZXROYW1lTGVucyA9IGlkTGVuczxTdHJlZXQ+KCkuZmllbGQoXCJuYW1lXCIpO1xuICAgIGNvbnN0IHN0cmVldDogU3RyZWV0ID0geyBuYW1lOiBcIm1haW4gc3RyZWV0XCIsIG51bWJlcjogNDIgfTtcbiAgICBleHBlY3QoU3RyZWV0TmFtZUxlbnMuZ2V0KHN0cmVldCkpLnRvRXF1YWwoXCJtYWluIHN0cmVldFwiKTtcbiAgICBleHBlY3QoXG4gICAgICBTdHJlZXROYW1lTGVucy51cGRhdGVXaXRoUmVzdWx0KHN0cmVldCwgKG4pID0+IFtcInNtYWxsIFwiICsgbiwgXCJ5YWxsYVwiXSlcbiAgICApLnRvRXF1YWwoW3sgbmFtZTogXCJzbWFsbCBtYWluIHN0cmVldFwiLCBudW1iZXI6IDQyIH0sIFwieWFsbGFcIl0pO1xuICB9KTtcblxuICB0ZXN0KFwiZGVlcGVyXCIsICgpID0+IHtcbiAgICBjb25zdCBBZHJlc3NTdHJlZXROYW1lTGVucyA9IGlkTGVuczxBZGRyZXNzPigpXG4gICAgICAuZmllbGQoXCJzdHJlZXRcIilcbiAgICAgIC5maWVsZChcIm5hbWVcIik7XG4gICAgY29uc3QgYWRkcmVzczogQWRkcmVzcyA9IHtcbiAgICAgIHN0cmVldDogeyBuYW1lOiBcIm1haW4gc3RyZWV0XCIsIG51bWJlcjogNDIgfSxcbiAgICAgIGNpdHk6IHsgbmFtZTogXCJCaWdcIiwgemlwOiBcIjQyNDJcIiB9LFxuICAgIH07XG4gICAgZXhwZWN0KEFkcmVzc1N0cmVldE5hbWVMZW5zLmdldChhZGRyZXNzKSkudG9FcXVhbChcIm1haW4gc3RyZWV0XCIpO1xuICAgIGV4cGVjdChBZHJlc3NTdHJlZXROYW1lTGVucy51cGRhdGUoYWRkcmVzcywgKG4pID0+IFwic21hbGwgXCIgKyBuKSkudG9FcXVhbCh7XG4gICAgICBzdHJlZXQ6IHsgbmFtZTogXCJzbWFsbCBtYWluIHN0cmVldFwiLCBudW1iZXI6IDQyIH0sXG4gICAgICBjaXR5OiB7IG5hbWU6IFwiQmlnXCIsIHppcDogXCI0MjQyXCIgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdChcImRlZXBlciB3aXRoIHJlc3VsdFwiLCAoKSA9PiB7XG4gICAgY29uc3QgQWRyZXNzU3RyZWV0TmFtZUxlbnMgPSBpZExlbnM8QWRkcmVzcz4oKVxuICAgICAgLmZpZWxkKFwic3RyZWV0XCIpXG4gICAgICAuZmllbGQoXCJuYW1lXCIpO1xuICAgIGNvbnN0IGFkZHJlc3M6IEFkZHJlc3MgPSB7XG4gICAgICBzdHJlZXQ6IHsgbmFtZTogXCJtYWluIHN0cmVldFwiLCBudW1iZXI6IDQyIH0sXG4gICAgICBjaXR5OiB7IG5hbWU6IFwiQmlnXCIsIHppcDogXCI0MjQyXCIgfSxcbiAgICB9O1xuICAgIGV4cGVjdChBZHJlc3NTdHJlZXROYW1lTGVucy5nZXQoYWRkcmVzcykpLnRvRXF1YWwoXCJtYWluIHN0cmVldFwiKTtcbiAgICBleHBlY3QoXG4gICAgICBBZHJlc3NTdHJlZXROYW1lTGVucy51cGRhdGVXaXRoUmVzdWx0KGFkZHJlc3MsIChuKSA9PiBbXCJzbWFsbCBcIiArIG4sIDEyM10pXG4gICAgKS50b0VxdWFsKFtcbiAgICAgIHtcbiAgICAgICAgc3RyZWV0OiB7IG5hbWU6IFwic21hbGwgbWFpbiBzdHJlZXRcIiwgbnVtYmVyOiA0MiB9LFxuICAgICAgICBjaXR5OiB7IG5hbWU6IFwiQmlnXCIsIHppcDogXCI0MjQyXCIgfSxcbiAgICAgIH0sXG4gICAgICAxMjMsXG4gICAgXSk7XG4gIH0pO1xuXG4gIHRlc3QoXCJkaXNjcmltaW5hdGVkIGd1YXJkIHNcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGQ6IFN1YlR5cGVHdWFyZDxQYWdlLCBVc2VyUGFnZT4gPSBkaXNjcmltaW5hdGUoXCJ0YWdcIiwgXCJ1c2VyXCIpO1xuXG4gICAgY29uc3QgdXNlclBhZ2U6IFBhZ2UgPSB7IHRhZzogXCJ1c2VyXCIsIHVzZXI6IFwiZ251XCIgfTtcbiAgICBjb25zdCBob21lUGFnZTogUGFnZSA9IHsgdGFnOiBcImhvbWVcIiB9O1xuXG4gICAgZXhwZWN0KGQodXNlclBhZ2UpKS50b0VxdWFsKGp1c3QodXNlclBhZ2UpKTtcbiAgICBleHBlY3QoZChob21lUGFnZSkpLnRvRXF1YWwobm90aGluZyk7XG4gIH0pO1xuXG4gIHRlc3QoXCJkaXNjcmltaW5hdGVkIGd1YXJkIHdpdGggc2V2ZXJhbCB0YWdzXCIsICgpID0+IHtcbiAgICBjb25zdCBkOiBTdWJUeXBlR3VhcmQ8UGFnZTIsIFVzZXJQYWdlMj4gPSBkaXNjcmltaW5hdGUoXCJ0YWdcIiwgXCJ1c2VyXCIpO1xuICAgIGNvbnN0IGQyOiBTdWJUeXBlR3VhcmQ8UGFnZTIsIFVzZXJQYWdlMj4gPSBkaXNjcmltaW5hdGUoXCJ0YWcyXCIsIFwidXNlcjJcIik7XG5cbiAgICBjb25zdCB1c2VyUGFnZTogUGFnZTIgPSB7IHRhZzogXCJ1c2VyXCIsIHRhZzI6IFwidXNlcjJcIiwgdXNlcjogXCJnbnVcIiB9O1xuICAgIGNvbnN0IGhvbWVQYWdlOiBQYWdlMiA9IHsgdGFnOiBcImhvbWVcIiwgdGFnMjogXCJob21lMlwiIH07XG5cbiAgICBleHBlY3QoZCh1c2VyUGFnZSkpLnRvRXF1YWwoanVzdCh1c2VyUGFnZSkpO1xuICAgIGV4cGVjdChkKGhvbWVQYWdlKSkudG9FcXVhbChub3RoaW5nKTtcbiAgICBleHBlY3QoZDIodXNlclBhZ2UpKS50b0VxdWFsKGp1c3QodXNlclBhZ2UpKTtcbiAgICBleHBlY3QoZDIoaG9tZVBhZ2UpKS50b0VxdWFsKG5vdGhpbmcpO1xuICB9KTtcblxuICB0ZXN0KFwiZGlzY3JpbWluYXRlZCBzdWIgdHlwZSBwcmlzbVwiLCAoKSA9PiB7XG4gICAgY29uc3QgVXNlclBhZ2VVc2VyUHJpc20gPSBpZExlbnM8UGFnZT4oKS5zdWIoZGlzY3JpbWluYXRlKFwidGFnXCIsIFwidXNlclwiKSk7XG5cbiAgICBjb25zdCB1c2VyUGFnZTogUGFnZSA9IHsgdGFnOiBcInVzZXJcIiwgdXNlcjogXCJnbnVcIiB9O1xuICAgIGNvbnN0IGhvbWVQYWdlOiBQYWdlID0geyB0YWc6IFwiaG9tZVwiIH07XG5cbiAgICBleHBlY3QoVXNlclBhZ2VVc2VyUHJpc20uZ2V0KHVzZXJQYWdlKSkudG9FcXVhbChqdXN0KHVzZXJQYWdlKSk7XG4gICAgZXhwZWN0KFVzZXJQYWdlVXNlclByaXNtLmdldChob21lUGFnZSkpLnRvRXF1YWwobm90aGluZyk7XG5cbiAgICBleHBlY3QoXG4gICAgICBVc2VyUGFnZVVzZXJQcmlzbS51cGRhdGUodXNlclBhZ2UsICh1KSA9PiAoeyAuLi51LCB1c2VyOiBcImdudSFcIiB9KSlcbiAgICApLnRvRXF1YWwoanVzdCh7IHRhZzogXCJ1c2VyXCIsIHVzZXI6IFwiZ251IVwiIH0pKTtcbiAgICBleHBlY3QoXG4gICAgICBVc2VyUGFnZVVzZXJQcmlzbS51cGRhdGUoaG9tZVBhZ2UsICh1KSA9PiAoeyAuLi51LCB1c2VyOiBcImdudSFcIiB9KSlcbiAgICApLnRvRXF1YWwobm90aGluZyk7XG4gIH0pO1xuXG4gIHRlc3QoXCJkaXNjcmltaW5hdGVkIHN1YiB0eXBlIHByaXNtIHdpdGggcmVzdWx0XCIsICgpID0+IHtcbiAgICBjb25zdCBVc2VyUGFnZVVzZXJQcmlzbSA9IGlkTGVuczxQYWdlPigpLnN1YihkaXNjcmltaW5hdGUoXCJ0YWdcIiwgXCJ1c2VyXCIpKTtcblxuICAgIGNvbnN0IHVzZXJQYWdlOiBQYWdlID0geyB0YWc6IFwidXNlclwiLCB1c2VyOiBcImdudVwiIH07XG4gICAgY29uc3QgaG9tZVBhZ2U6IFBhZ2UgPSB7IHRhZzogXCJob21lXCIgfTtcblxuICAgIGV4cGVjdChVc2VyUGFnZVVzZXJQcmlzbS5nZXQodXNlclBhZ2UpKS50b0VxdWFsKGp1c3QodXNlclBhZ2UpKTtcbiAgICBleHBlY3QoVXNlclBhZ2VVc2VyUHJpc20uZ2V0KGhvbWVQYWdlKSkudG9FcXVhbChub3RoaW5nKTtcblxuICAgIGV4cGVjdChcbiAgICAgIFVzZXJQYWdlVXNlclByaXNtLnVwZGF0ZVdpdGhSZXN1bHQodXNlclBhZ2UsICh1KSA9PiBbXG4gICAgICAgIHsgLi4udSwgdXNlcjogXCJnbnUhXCIgfSxcbiAgICAgICAgMTIzLFxuICAgICAgXSlcbiAgICApLnRvRXF1YWwoanVzdChbeyB0YWc6IFwidXNlclwiLCB1c2VyOiBcImdudSFcIiB9LCAxMjNdKSk7XG4gICAgZXhwZWN0KFxuICAgICAgVXNlclBhZ2VVc2VyUHJpc20udXBkYXRlV2l0aFJlc3VsdChob21lUGFnZSwgKHUpID0+IFtcbiAgICAgICAgeyAuLi51LCB1c2VyOiBcImdudSFcIiB9LFxuICAgICAgICAxMjMsXG4gICAgICBdKVxuICAgICkudG9FcXVhbChub3RoaW5nKTtcbiAgfSk7XG5cbiAgY29uc3QgcGxheWVyOiBNdXNpY1BsYXllciA9IHtcbiAgICB0YWc6IFwicGxheWVyXCIsXG4gICAgdGFiOiB7XG4gICAgICB0YWc6IFwiYXJ0aXN0c1wiLFxuICAgICAgY291bnQ6IDEyMyxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHBsYXllckhvbWU6IE11c2ljUGxheWVyID0ge1xuICAgIHRhZzogXCJob21lXCIsXG4gIH07XG5cbiAgY29uc3QgcGxheWVyQWxidW1zOiBNdXNpY1BsYXllciA9IHtcbiAgICB0YWc6IFwicGxheWVyXCIsXG4gICAgdGFiOiB7XG4gICAgICB0YWc6IFwiYWxidW1zXCIsXG4gICAgfSxcbiAgfTtcblxuICB0ZXN0KFwiZGlzY3JpbWluYXRlZCBzdWIgdHlwZSBmaWVsZCBwcmlzbVwiLCAoKSA9PiB7XG4gICAgLy8gY29uc3QgVXNlclBhZ2VVc2VyUHJpc20gPSBpZExlbnM8UGFnZT4oKS5zdWIocCA9PiBwLnRhZyA9PT0gJ3VzZXInID8gcCBhcyBVc2VyUGFnZSA6IHVuZGVmaW5lZCkuZmllbGQoJ3VzZXInKVxuXG4gICAgY29uc3QgVXNlclBhZ2VVc2VyUHJpc20gPSBpZExlbnM8UGFnZT4oKS5zdWI8VXNlclBhZ2U+KGRpc2NyaW1pbmF0ZShcInRhZ1wiLCBcInVzZXJcIikpLmZpZWxkKFwidXNlclwiKTtcbiAgICAvLyBXT05UV09SS1xuICAgIC8vIGNvbnN0IFVzZXJQYWdlVXNlclByaXNtMiA9IGlkTGVuczxQYWdlPigpLnN1YihMZW5zZXMuZGVzY3JpbWluYXRlKCd0YWcnLCAndXNlcicpKS5maWVsZCgndXNlcicpXG5cbiAgICBjb25zdCB1c2VyUGFnZTogUGFnZSA9IHsgdGFnOiBcInVzZXJcIiwgdXNlcjogXCJnbnVcIiB9O1xuICAgIGNvbnN0IGhvbWVQYWdlOiBQYWdlID0geyB0YWc6IFwiaG9tZVwiIH07XG5cbiAgICBleHBlY3QoVXNlclBhZ2VVc2VyUHJpc20uZ2V0KHVzZXJQYWdlKSkudG9FcXVhbChqdXN0KFwiZ251XCIpKTtcbiAgICBleHBlY3QoVXNlclBhZ2VVc2VyUHJpc20uZ2V0KGhvbWVQYWdlKSkudG9FcXVhbChub3RoaW5nKTtcblxuICAgIGV4cGVjdChVc2VyUGFnZVVzZXJQcmlzbS51cGRhdGUodXNlclBhZ2UsICh1KSA9PiB1ICsgXCIhXCIpKS50b0VxdWFsKFxuICAgICAganVzdCh7IHRhZzogXCJ1c2VyXCIsIHVzZXI6IFwiZ251IVwiIH0pXG4gICAgKTtcbiAgICBleHBlY3QoVXNlclBhZ2VVc2VyUHJpc20udXBkYXRlKGhvbWVQYWdlLCAodSkgPT4gdSArIFwiIVwiKSkudG9FcXVhbChub3RoaW5nKTtcbiAgfSk7XG5cbiAgdGVzdChcImRpc2NyaW1pbmF0ZWQgc3ViIHR3aWNlXCIsICgpID0+IHtcbiAgICBjb25zdCBBcnRpc3RzUHJpc20gPSBpZExlbnM8TXVzaWNQbGF5ZXI+KClcbiAgICAgIC5zdWI8UGxheWVyPihkaXNjcmltaW5hdGUoXCJ0YWdcIiwgXCJwbGF5ZXJcIikpXG4gICAgICAuZmllbGQoXCJ0YWJcIilcbiAgICAgIC5zdWI8QXJ0aXN0cz4oZGlzY3JpbWluYXRlKFwidGFnXCIsIFwiYXJ0aXN0c1wiKSlcbiAgICAgIC5maWVsZChcImNvdW50XCIpO1xuXG4gICAgZXhwZWN0KEFydGlzdHNQcmlzbS5nZXQocGxheWVyKSkudG9FcXVhbChqdXN0KDEyMykpO1xuICAgIGV4cGVjdChBcnRpc3RzUHJpc20uZ2V0KHBsYXllckhvbWUpKS50b0VxdWFsKG5vdGhpbmcpO1xuICAgIGV4cGVjdChBcnRpc3RzUHJpc20uZ2V0KHBsYXllckFsYnVtcykpLnRvRXF1YWwobm90aGluZyk7XG4gICAgZXhwZWN0KEFydGlzdHNQcmlzbS51cGRhdGUocGxheWVyLCAoYykgPT4gYyArIDEpKS50b0VxdWFsKFxuICAgICAganVzdCh7XG4gICAgICAgIHRhZzogXCJwbGF5ZXJcIixcbiAgICAgICAgdGFiOiB7XG4gICAgICAgICAgdGFnOiBcImFydGlzdHNcIixcbiAgICAgICAgICBjb3VudDogMTI0LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICApO1xuICAgIGV4cGVjdChBcnRpc3RzUHJpc20udXBkYXRlKHBsYXllckhvbWUsIChjKSA9PiBjICsgMSkpLnRvRXF1YWwobm90aGluZyk7XG4gICAgZXhwZWN0KEFydGlzdHNQcmlzbS51cGRhdGUocGxheWVyQWxidW1zLCAoYykgPT4gYyArIDEpKS50b0VxdWFsKG5vdGhpbmcpO1xuICB9KTtcblxuICB0ZXN0KFwiZGlzY3JpbWluYXRlZCBzdWIgdHdpY2Ugd2l0aCByZXN1bHRcIiwgKCkgPT4ge1xuICAgIGNvbnN0IEFydGlzdHNQcmlzbSA9IGlkTGVuczxNdXNpY1BsYXllcj4oKVxuICAgICAgLnN1YjxQbGF5ZXI+KGRpc2NyaW1pbmF0ZShcInRhZ1wiLCBcInBsYXllclwiKSlcbiAgICAgIC5maWVsZChcInRhYlwiKVxuICAgICAgLnN1YjxBcnRpc3RzPihkaXNjcmltaW5hdGUoXCJ0YWdcIiwgXCJhcnRpc3RzXCIpKVxuICAgICAgLmZpZWxkKFwiY291bnRcIik7XG5cbiAgICBleHBlY3QoQXJ0aXN0c1ByaXNtLnVwZGF0ZVdpdGhSZXN1bHQocGxheWVyLCAoYykgPT4gW2MgKyAxLCAxMjNdKSkudG9FcXVhbChcbiAgICAgIGp1c3QoW1xuICAgICAgICB7XG4gICAgICAgICAgdGFnOiBcInBsYXllclwiLFxuICAgICAgICAgIHRhYjoge1xuICAgICAgICAgICAgdGFnOiBcImFydGlzdHNcIixcbiAgICAgICAgICAgIGNvdW50OiAxMjQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgMTIzLFxuICAgICAgXSlcbiAgICApO1xuICAgIGV4cGVjdChcbiAgICAgIEFydGlzdHNQcmlzbS51cGRhdGVXaXRoUmVzdWx0KHBsYXllckhvbWUsIChjKSA9PiBbYyArIDEsIDEyM10pXG4gICAgKS50b0VxdWFsKG5vdGhpbmcpO1xuICAgIGV4cGVjdChcbiAgICAgIEFydGlzdHNQcmlzbS51cGRhdGVXaXRoUmVzdWx0KHBsYXllckFsYnVtcywgKGMpID0+IFtjICsgMSwgMTIzXSlcbiAgICApLnRvRXF1YWwobm90aGluZyk7XG4gIH0pO1xuXG4gIHRlc3QoXCJjb21wb3NlIGxlbnNlc1wiLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RyZWV0TGVucyA9IGlkTGVuczxBZGRyZXNzPigpLmZpZWxkKFwic3RyZWV0XCIpO1xuICAgIGNvbnN0IG5hbWVMZW5zID0gaWRMZW5zPFN0cmVldD4oKS5maWVsZChcIm5hbWVcIik7XG4gICAgY29uc3QgY29tcG9zZWQgPSBzdHJlZXRMZW5zLmFuZFRoZW5MZW5zKG5hbWVMZW5zKTtcblxuICAgIGNvbnN0IGFkZHJlc3M6IEFkZHJlc3MgPSB7XG4gICAgICBzdHJlZXQ6IHsgbmFtZTogXCJtYWluIHN0cmVldFwiLCBudW1iZXI6IDQyIH0sXG4gICAgICBjaXR5OiB7IG5hbWU6IFwiQmlnXCIsIHppcDogXCI0MjQyXCIgfSxcbiAgICB9O1xuICAgIGV4cGVjdChjb21wb3NlZC5nZXQoYWRkcmVzcykpLnRvRXF1YWwoXCJtYWluIHN0cmVldFwiKTtcbiAgICBleHBlY3QoY29tcG9zZWQudXBkYXRlKGFkZHJlc3MsIChuKSA9PiBcInNtYWxsIFwiICsgbikpLnRvRXF1YWwoe1xuICAgICAgc3RyZWV0OiB7IG5hbWU6IFwic21hbGwgbWFpbiBzdHJlZXRcIiwgbnVtYmVyOiA0MiB9LFxuICAgICAgY2l0eTogeyBuYW1lOiBcIkJpZ1wiLCB6aXA6IFwiNDI0MlwiIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoXCJjb21wb3NlIGxlbnNlcyB3aXRoIHJlc3VsdFwiLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RyZWV0TGVucyA9IGlkTGVuczxBZGRyZXNzPigpLmZpZWxkKFwic3RyZWV0XCIpO1xuICAgIGNvbnN0IG5hbWVMZW5zID0gaWRMZW5zPFN0cmVldD4oKS5maWVsZChcIm5hbWVcIik7XG4gICAgY29uc3QgY29tcG9zZWQgPSBzdHJlZXRMZW5zLmFuZFRoZW5MZW5zKG5hbWVMZW5zKTtcblxuICAgIGNvbnN0IGFkZHJlc3M6IEFkZHJlc3MgPSB7XG4gICAgICBzdHJlZXQ6IHsgbmFtZTogXCJtYWluIHN0cmVldFwiLCBudW1iZXI6IDQyIH0sXG4gICAgICBjaXR5OiB7IG5hbWU6IFwiQmlnXCIsIHppcDogXCI0MjQyXCIgfSxcbiAgICB9O1xuICAgIGV4cGVjdChcbiAgICAgIGNvbXBvc2VkLnVwZGF0ZVdpdGhSZXN1bHQoYWRkcmVzcywgKG4pID0+IFtcInNtYWxsIFwiICsgbiwgdHJ1ZV0pXG4gICAgKS50b0VxdWFsKFtcbiAgICAgIHtcbiAgICAgICAgc3RyZWV0OiB7IG5hbWU6IFwic21hbGwgbWFpbiBzdHJlZXRcIiwgbnVtYmVyOiA0MiB9LFxuICAgICAgICBjaXR5OiB7IG5hbWU6IFwiQmlnXCIsIHppcDogXCI0MjQyXCIgfSxcbiAgICAgIH0sXG4gICAgICB0cnVlLFxuICAgIF0pO1xuICB9KTtcblxuICB0ZXN0KFwiY29tcG9zZSBwcmlzbSBhbmQgbGVuc1wiLCAoKSA9PiB7XG4gICAgY29uc3QgcCA9IGlkTGVuczxQYWdlPigpLnN1YjxVc2VyUGFnZT4oZGlzY3JpbWluYXRlKFwidGFnXCIsIFwidXNlclwiKSk7XG4gICAgY29uc3QgbCA9IGlkTGVuczxVc2VyUGFnZT4oKS5maWVsZChcInVzZXJcIik7XG4gICAgY29uc3QgY29tcG9zZWQgPSBwLmFuZFRoZW4obCk7XG5cbiAgICBjb25zdCB1c2VyUGFnZTogUGFnZSA9IHsgdGFnOiBcInVzZXJcIiwgdXNlcjogXCJnbnVcIiB9O1xuICAgIGNvbnN0IGhvbWVQYWdlOiBQYWdlID0geyB0YWc6IFwiaG9tZVwiIH07XG5cbiAgICBleHBlY3QoY29tcG9zZWQuZ2V0KHVzZXJQYWdlKSkudG9FcXVhbChqdXN0KFwiZ251XCIpKTtcbiAgICBleHBlY3QoY29tcG9zZWQuZ2V0KGhvbWVQYWdlKSkudG9FcXVhbChub3RoaW5nKTtcblxuICAgIGV4cGVjdChjb21wb3NlZC51cGRhdGUodXNlclBhZ2UsICh1KSA9PiB1ICsgXCIhXCIpKS50b0VxdWFsKFxuICAgICAganVzdCh7IHRhZzogXCJ1c2VyXCIsIHVzZXI6IFwiZ251IVwiIH0pXG4gICAgKTtcbiAgICBleHBlY3QoY29tcG9zZWQudXBkYXRlKGhvbWVQYWdlLCAodSkgPT4gdSArIFwiIVwiKSkudG9FcXVhbChub3RoaW5nKTtcbiAgfSk7XG5cbiAgdGVzdChcImNvbXBvc2UgcHJpc20gYW5kIGxlbnMgd2l0aCByZXN1bHRcIiwgKCkgPT4ge1xuICAgIGNvbnN0IHAgPSBpZExlbnM8UGFnZT4oKS5zdWI8VXNlclBhZ2U+KGRpc2NyaW1pbmF0ZShcInRhZ1wiLCBcInVzZXJcIikpO1xuICAgIGNvbnN0IGwgPSBpZExlbnM8VXNlclBhZ2U+KCkuZmllbGQoXCJ1c2VyXCIpO1xuICAgIGNvbnN0IGNvbXBvc2VkID0gcC5hbmRUaGVuKGwpO1xuXG4gICAgY29uc3QgdXNlclBhZ2U6IFBhZ2UgPSB7IHRhZzogXCJ1c2VyXCIsIHVzZXI6IFwiZ251XCIgfTtcbiAgICBjb25zdCBob21lUGFnZTogUGFnZSA9IHsgdGFnOiBcImhvbWVcIiB9O1xuXG4gICAgZXhwZWN0KGNvbXBvc2VkLmdldCh1c2VyUGFnZSkpLnRvRXF1YWwoanVzdChcImdudVwiKSk7XG4gICAgZXhwZWN0KGNvbXBvc2VkLmdldChob21lUGFnZSkpLnRvRXF1YWwobm90aGluZyk7XG5cbiAgICBleHBlY3QoXG4gICAgICBjb21wb3NlZC51cGRhdGVXaXRoUmVzdWx0KHVzZXJQYWdlLCAodSkgPT4gW3UgKyBcIiFcIiwgZmFsc2VdKVxuICAgICkudG9FcXVhbChqdXN0KFt7IHRhZzogXCJ1c2VyXCIsIHVzZXI6IFwiZ251IVwiIH0sIGZhbHNlXSkpO1xuICAgIGV4cGVjdChcbiAgICAgIGNvbXBvc2VkLnVwZGF0ZVdpdGhSZXN1bHQoaG9tZVBhZ2UsICh1KSA9PiBbdSArIFwiIVwiLCBmYWxzZV0pXG4gICAgKS50b0VxdWFsKG5vdGhpbmcpO1xuICB9KTtcblxuICB0ZXN0KFwiY29tcG9zZSBwcmlzbXNcIiwgKCkgPT4ge1xuICAgIGNvbnN0IHAxID0gaWRMZW5zPE11c2ljUGxheWVyPigpLnN1YjxQbGF5ZXI+KGRpc2NyaW1pbmF0ZShcInRhZ1wiLCBcInBsYXllclwiKSk7XG4gICAgY29uc3QgcDIgPSBpZExlbnM8UGxheWVyPigpXG4gICAgICAuZmllbGQoXCJ0YWJcIilcbiAgICAgIC5zdWI8QXJ0aXN0cz4oZGlzY3JpbWluYXRlKFwidGFnXCIsIFwiYXJ0aXN0c1wiKSk7XG4gICAgY29uc3QgY29tcG9zZWQgPSBwMS5hbmRUaGVuKHAyKTtcblxuICAgIGV4cGVjdChcbiAgICAgIGNvbXBvc2VkLnVwZGF0ZVdpdGhSZXN1bHQocGxheWVyLCAoYykgPT4gW3sgLi4uYywgY291bnQ6IDQ1NiB9LCBmYWxzZV0pXG4gICAgKS50b0VxdWFsKFxuICAgICAganVzdChbXG4gICAgICAgIHtcbiAgICAgICAgICB0YWc6IFwicGxheWVyXCIsXG4gICAgICAgICAgdGFiOiB7XG4gICAgICAgICAgICB0YWc6IFwiYXJ0aXN0c1wiLFxuICAgICAgICAgICAgY291bnQ6IDQ1NixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBmYWxzZSxcbiAgICAgIF0pXG4gICAgKTtcbiAgICBleHBlY3QoXG4gICAgICBjb21wb3NlZC51cGRhdGVXaXRoUmVzdWx0KHBsYXllckhvbWUsIChjKSA9PiBbeyAuLi5jLCBjb3VudDogNDU2IH0sIDEyM10pXG4gICAgKS50b0VxdWFsKG5vdGhpbmcpO1xuICAgIGV4cGVjdChcbiAgICAgIGNvbXBvc2VkLnVwZGF0ZVdpdGhSZXN1bHQocGxheWVyQWxidW1zLCAoYykgPT4gW1xuICAgICAgICB7IC4uLmMsIGNvdW50OiA0NTYgfSxcbiAgICAgICAgMTIzLFxuICAgICAgXSlcbiAgICApLnRvRXF1YWwobm90aGluZyk7XG4gIH0pO1xuXG4gIGNvbnN0IGFwcDE6IEFwcFdpdGhQYWdlID0ge1xuICAgIHBhZ2U6IGp1c3Qoe1xuICAgICAgdGFnOiBcImhvbWVcIixcbiAgICB9KSxcbiAgfTtcblxuICBjb25zdCBhcHAyOiBBcHBXaXRoUGFnZSA9IHtcbiAgICBwYWdlOiBub3RoaW5nLFxuICB9O1xuXG4gIHRlc3QoXCJmbGF0dGVuIGZpZWxkIG1heWJlXCIsICgpID0+IHtcbiAgICBjb25zdCBsID0gaWRMZW5zPEFwcFdpdGhQYWdlPigpLmZpZWxkKFwicGFnZVwiKS5mbGF0dGVuKCk7XG5cbiAgICBleHBlY3QobC5nZXQoYXBwMSkpLnRvRXF1YWwoanVzdCh7IHRhZzogXCJob21lXCIgfSkpO1xuICAgIGV4cGVjdChsLmdldChhcHAyKSkudG9FcXVhbChub3RoaW5nKTtcblxuICAgIGV4cGVjdChsLnVwZGF0ZShhcHAxLCAoKSA9PiAoeyB0YWc6IFwidXNlclwiLCB1c2VyOiBcImZvb2JhclwiIH0pKSkudG9FcXVhbChcbiAgICAgIGp1c3Qoe1xuICAgICAgICBwYWdlOiBqdXN0KHsgdGFnOiBcInVzZXJcIiwgdXNlcjogXCJmb29iYXJcIiB9KSxcbiAgICAgIH0pXG4gICAgKTtcbiAgICBleHBlY3QobC51cGRhdGUoYXBwMiwgKCkgPT4gKHsgdGFnOiBcInVzZXJcIiwgdXNlcjogXCJmb29iYXJcIiB9KSkpLnRvRXF1YWwoXG4gICAgICBub3RoaW5nXG4gICAgKTtcbiAgfSk7XG5cbiAgdGVzdChcInNldCBtYXliZSBmaWVsZFwiLCAoKSA9PiB7XG4gICAgY29uc3QgbCA9IGlkTGVuczxBcHBXaXRoUGFnZT4oKS5maWVsZChcInBhZ2VcIik7XG4gICAgZXhwZWN0KGwuZ2V0KGFwcDEpKS50b0VxdWFsKFxuICAgICAganVzdCh7XG4gICAgICAgIHRhZzogXCJob21lXCIsXG4gICAgICB9KVxuICAgICk7XG4gICAgZXhwZWN0KGwudXBkYXRlKGFwcDEsICgpID0+IG5vdGhpbmcpKS50b0VxdWFsKHtcbiAgICAgIHBhZ2U6IG5vdGhpbmcsXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoXCJmbGF0dGVuIHByaXNtc1wiLCAoKSA9PiB7XG4gICAgY29uc3QgcCA9IGlkTGVuczxQYWdlPigpLnN1YjxNb3JlUGFnZT4oZGlzY3JpbWluYXRlKFwidGFnXCIsIFwibW9yZVwiKSk7XG4gICAgY29uc3QgbCA9IGlkTGVuczxNb3JlUGFnZT4oKS5maWVsZChcIm1vcmVcIik7XG4gICAgY29uc3QgZmxhdHRlbmVkID0gcC5hbmRUaGVuKGwpLmZsYXR0ZW4oKTtcblxuICAgIC8vIGNvbnN0IGNvbXBpbGVFcnJvcjEgPSBpZExlbnM8UGFnZT4oKS5mbGF0dGVuKCkuc2V0KHsgdGFnOiBcImhvbWVcIiB9LCAxMyk7XG4gICAgLy8gY29uc3QgY29tcGlsZUVycm9yMSA9IGlkTGVuczxQYWdlPigpLmZsYXR0ZW4oKS5nZXQoeyB0YWc6IFwiaG9tZVwiIH0pLndpdGhEZWZhdWx0KDEzKTtcblxuICAgIGNvbnN0IG1vcmVQYWdlMTogUGFnZSA9IHsgdGFnOiBcIm1vcmVcIiwgbW9yZTogbm90aGluZyB9O1xuICAgIGNvbnN0IG1vcmVQYWdlMjogUGFnZSA9IHsgdGFnOiBcIm1vcmVcIiwgbW9yZToganVzdChcImdudVwiKSB9O1xuICAgIGNvbnN0IGhvbWVQYWdlOiBQYWdlID0geyB0YWc6IFwiaG9tZVwiIH07XG5cbiAgICBleHBlY3QoZmxhdHRlbmVkLmdldChtb3JlUGFnZTEpKS50b0VxdWFsKG5vdGhpbmcpO1xuICAgIGV4cGVjdChmbGF0dGVuZWQuZ2V0KG1vcmVQYWdlMikpLnRvRXF1YWwoanVzdChcImdudVwiKSk7XG4gICAgZXhwZWN0KGZsYXR0ZW5lZC5nZXQoaG9tZVBhZ2UpKS50b0VxdWFsKG5vdGhpbmcpO1xuXG4gICAgZXhwZWN0KGZsYXR0ZW5lZC51cGRhdGUobW9yZVBhZ2UxLCAodSkgPT4gdSArIFwiIVwiKSkudG9FcXVhbChub3RoaW5nKTtcbiAgICBleHBlY3QoZmxhdHRlbmVkLnVwZGF0ZShtb3JlUGFnZTIsICh1KSA9PiB1ICsgXCIhXCIpKS50b0VxdWFsKFxuICAgICAganVzdCh7IHRhZzogXCJtb3JlXCIsIG1vcmU6IGp1c3QoXCJnbnUhXCIpIH0pXG4gICAgKTtcbiAgICBleHBlY3QoZmxhdHRlbmVkLnVwZGF0ZShob21lUGFnZSwgKHUpID0+IHUgKyBcIiFcIikpLnRvRXF1YWwobm90aGluZyk7XG4gIH0pO1xufSk7XG5cbmludGVyZmFjZSBBcHBXaXRoUGFnZSB7XG4gIHJlYWRvbmx5IHBhZ2U6IE1heWJlPFBhZ2U+O1xufVxuXG5pbnRlcmZhY2UgU3RyZWV0IHtcbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nO1xuICByZWFkb25seSBudW1iZXI6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIENpdHkge1xuICByZWFkb25seSBuYW1lOiBzdHJpbmc7XG4gIHJlYWRvbmx5IHppcDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgQWRkcmVzcyB7XG4gIHJlYWRvbmx5IHN0cmVldDogU3RyZWV0O1xuICByZWFkb25seSBjaXR5OiBDaXR5O1xufVxuXG50eXBlIFBhZ2UgPSB7IHJlYWRvbmx5IHRhZzogXCJob21lXCIgfSB8IFVzZXJQYWdlIHwgTW9yZVBhZ2U7XG50eXBlIFVzZXJQYWdlID0geyByZWFkb25seSB0YWc6IFwidXNlclwiOyByZWFkb25seSB1c2VyOiBzdHJpbmcgfTtcbnR5cGUgTW9yZVBhZ2UgPSB7IHJlYWRvbmx5IHRhZzogXCJtb3JlXCI7IHJlYWRvbmx5IG1vcmU6IE1heWJlPHN0cmluZz4gfTtcblxudHlwZSBQYWdlMiA9IHsgcmVhZG9ubHkgdGFnOiBcImhvbWVcIjsgcmVhZG9ubHkgdGFnMjogXCJob21lMlwiIH0gfCBVc2VyUGFnZTI7XG50eXBlIFVzZXJQYWdlMiA9IHtcbiAgcmVhZG9ubHkgdGFnOiBcInVzZXJcIjtcbiAgcmVhZG9ubHkgdGFnMjogXCJ1c2VyMlwiO1xuICByZWFkb25seSB1c2VyOiBzdHJpbmc7XG59O1xuXG50eXBlIE11c2ljUGxheWVyID0geyB0YWc6IFwiaG9tZVwiIH0gfCBQbGF5ZXI7XG50eXBlIFBsYXllciA9IHsgdGFnOiBcInBsYXllclwiOyB0YWI6IFRhYiB9O1xudHlwZSBUYWIgPSB7IHRhZzogXCJhbGJ1bXNcIiB9IHwgQXJ0aXN0cztcbnR5cGUgQXJ0aXN0cyA9IHsgdGFnOiBcImFydGlzdHNcIjsgY291bnQ6IG51bWJlciB9O1xuIl19