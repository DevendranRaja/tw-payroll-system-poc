/*
 * MIT License
 *
 * Copyright (c) 2019 RÃ©mi Van Keisbelck
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
import { Cmd } from './Cmd';
/**
 * Piped updates.
 * Useful for chaining building blocks making up the update loop.
 */
export function updatePiped(model, ...updates) {
    const none = Cmd.none();
    const combine = (cmd1, cmd2) => {
        const none1 = isNone(cmd1);
        const none2 = isNone(cmd2);
        return none1 && none2 ? cmd1 : none1 ? cmd2 : none2 ? cmd1 : Cmd.batch([cmd1, cmd2]);
    };
    return genericUpdatePiped(combine, none, model, ...updates);
}
function isNone(cmd) {
    return cmd.constructor.name === 'CmdNone';
}
/**
 * Generic implementation of chained updates.
 * See updatePiped().
 */
export function genericUpdatePiped(combine, none, model, ...updates) {
    return updates.reduce((acc, update) => {
        const [model0, cmd0] = acc;
        const [model1, cmd1] = update(model0);
        return [model1, combine(cmd0, cmd1)];
    }, [model, none]);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXBkYXRlUGlwZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvVGVhQ3VwL1VwZGF0ZVBpcGVkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXVCRztBQUVILE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFJNUI7OztHQUdHO0FBQ0gsTUFBTSxVQUFVLFdBQVcsQ0FDekIsS0FBWSxFQUNaLEdBQUcsT0FBOEM7SUFFakQsTUFBTSxJQUFJLEdBQWEsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2xDLE1BQU0sT0FBTyxHQUFHLENBQUMsSUFBYyxFQUFFLElBQWMsRUFBRSxFQUFFO1FBQ2pELE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsT0FBTyxLQUFLLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3ZGLENBQUMsQ0FBQztJQUNGLE9BQU8sa0JBQWtCLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRyxPQUFPLENBQUMsQ0FBQztBQUM5RCxDQUFDO0FBRUQsU0FBUyxNQUFNLENBQU0sR0FBYTtJQUNoQyxPQUFPLEdBQUcsQ0FBQyxXQUFXLENBQUMsSUFBSSxLQUFLLFNBQVMsQ0FBQztBQUM1QyxDQUFDO0FBSUQ7OztHQUdHO0FBQ0gsTUFBTSxVQUFVLGtCQUFrQixDQUNoQyxPQUFzQyxFQUN0QyxJQUFTLEVBQ1QsS0FBWSxFQUNaLEdBQUcsT0FBcUQ7SUFFeEQsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUNuQixDQUFDLEdBQWlCLEVBQUUsTUFBeUMsRUFBRSxFQUFFO1FBQy9ELE1BQU0sQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQzNCLE1BQU0sQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3RDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsRUFDRCxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FDZCxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNSVQgTGljZW5zZVxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxOSBSw6ltaSBWYW4gS2Vpc2JlbGNrXG4gKlxuICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuICogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4gKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuICpcbiAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuICogY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbiAqXG4gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG4gKiBTT0ZUV0FSRS5cbiAqXG4gKi9cblxuaW1wb3J0IHsgQ21kIH0gZnJvbSAnLi9DbWQnO1xuXG5leHBvcnQgdHlwZSBVcGRhdGVGdW5jdGlvbjxNb2RlbCwgTXNnPiA9IEdlbmVyaWNVcGRhdGVGdW5jdGlvbjxNb2RlbCwgQ21kPE1zZz4+O1xuXG4vKipcbiAqIFBpcGVkIHVwZGF0ZXMuXG4gKiBVc2VmdWwgZm9yIGNoYWluaW5nIGJ1aWxkaW5nIGJsb2NrcyBtYWtpbmcgdXAgdGhlIHVwZGF0ZSBsb29wLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUGlwZWQ8TW9kZWwsIE1zZz4oXG4gIG1vZGVsOiBNb2RlbCxcbiAgLi4udXBkYXRlczogcmVhZG9ubHkgVXBkYXRlRnVuY3Rpb248TW9kZWwsIE1zZz5bXVxuKTogW01vZGVsLCBDbWQ8TXNnPl0ge1xuICBjb25zdCBub25lOiBDbWQ8TXNnPiA9IENtZC5ub25lKCk7XG4gIGNvbnN0IGNvbWJpbmUgPSAoY21kMTogQ21kPE1zZz4sIGNtZDI6IENtZDxNc2c+KSA9PiB7XG4gICAgY29uc3Qgbm9uZTEgPSBpc05vbmUoY21kMSk7XG4gICAgY29uc3Qgbm9uZTIgPSBpc05vbmUoY21kMik7XG4gICAgcmV0dXJuIG5vbmUxICYmIG5vbmUyID8gY21kMSA6IG5vbmUxID8gY21kMiA6IG5vbmUyID8gY21kMSA6IENtZC5iYXRjaChbY21kMSwgY21kMl0pO1xuICB9O1xuICByZXR1cm4gZ2VuZXJpY1VwZGF0ZVBpcGVkKGNvbWJpbmUsIG5vbmUsIG1vZGVsLCAuLi51cGRhdGVzKTtcbn1cblxuZnVuY3Rpb24gaXNOb25lPE1zZz4oY21kOiBDbWQ8TXNnPik6IGJvb2xlYW4ge1xuICByZXR1cm4gY21kLmNvbnN0cnVjdG9yLm5hbWUgPT09ICdDbWROb25lJztcbn1cblxuZXhwb3J0IHR5cGUgR2VuZXJpY1VwZGF0ZUZ1bmN0aW9uPE1vZGVsLCBDbWQ+ID0gKG1vZGVsOiBNb2RlbCkgPT4gW01vZGVsLCBDbWRdO1xuXG4vKipcbiAqIEdlbmVyaWMgaW1wbGVtZW50YXRpb24gb2YgY2hhaW5lZCB1cGRhdGVzLlxuICogU2VlIHVwZGF0ZVBpcGVkKCkuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmljVXBkYXRlUGlwZWQ8TW9kZWwsIENtZD4oXG4gIGNvbWJpbmU6IChjbWQxOiBDbWQsIGNtZDI6IENtZCkgPT4gQ21kLFxuICBub25lOiBDbWQsXG4gIG1vZGVsOiBNb2RlbCxcbiAgLi4udXBkYXRlczogcmVhZG9ubHkgR2VuZXJpY1VwZGF0ZUZ1bmN0aW9uPE1vZGVsLCBDbWQ+W11cbik6IFtNb2RlbCwgQ21kXSB7XG4gIHJldHVybiB1cGRhdGVzLnJlZHVjZTxbTW9kZWwsIENtZF0+KFxuICAgIChhY2M6IFtNb2RlbCwgQ21kXSwgdXBkYXRlOiBHZW5lcmljVXBkYXRlRnVuY3Rpb248TW9kZWwsIENtZD4pID0+IHtcbiAgICAgIGNvbnN0IFttb2RlbDAsIGNtZDBdID0gYWNjO1xuICAgICAgY29uc3QgW21vZGVsMSwgY21kMV0gPSB1cGRhdGUobW9kZWwwKTtcbiAgICAgIHJldHVybiBbbW9kZWwxLCBjb21iaW5lKGNtZDAsIGNtZDEpXTtcbiAgICB9LFxuICAgIFttb2RlbCwgbm9uZV0sXG4gICk7XG59XG4iXX0=